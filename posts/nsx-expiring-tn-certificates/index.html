

<!DOCTYPE html>
<html lang="en-us">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics">
  // Hier kommt dein GA-Code (Google Analytics 4 empfohlen!)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNTG7NNKQN', { 'anonymize_ip': true });
</script>

<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics" src="https://www.googletagmanager.com/gtag/js?id=G-YNTG7NNKQN"></script>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow"><link rel="author" href="/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="SDN-Warrior"><meta name="description" content="On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.">

  <meta itemprop="name" content="NSX Expiring Transport Node Certificates">
  <meta itemprop="description" content="On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.">
  <meta itemprop="datePublished" content="2025-05-06T18:00:00+02:00">
  <meta itemprop="dateModified" content="2025-05-06T18:00:00+02:00">
  <meta itemprop="wordCount" content="1591">
  <meta itemprop="image" content="http://localhost:1313/images/preview.png">
  <meta itemprop="keywords" content="Nsx,Vmware,Homelab"><meta property="og:url" content="http://localhost:1313/posts/nsx-expiring-tn-certificates/">
  <meta property="og:site_name" content="SDN-Warrior | Daniel Krieger">
  <meta property="og:title" content="NSX Expiring Transport Node Certificates">
  <meta property="og:description" content="On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-05-06T18:00:00+02:00">
    <meta property="article:modified_time" content="2025-05-06T18:00:00+02:00">
    <meta property="article:tag" content="Nsx">
    <meta property="article:tag" content="Vmware">
    <meta property="article:tag" content="Homelab">
    <meta property="og:image" content="http://localhost:1313/images/preview.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/images/preview.png">
  <meta name="twitter:title" content="NSX Expiring Transport Node Certificates">
  <meta name="twitter:description" content="On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "NSX Expiring Transport Node Certificates",
    "name": "NSX Expiring Transport Node Certificates",
    "description": "On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.",
    "keywords": ["nsx", "vmware", "homelab"],
    "articleBody": "Introduction In NSX versions 4.1.x and 4.2.0, edge transport nodes and host transport nodes are instantiated using certificates with a validity period of only 825 days. This is obviously not desirable behavior and has been fixed in newer versions of NSX. Interestingly, I haven’t seen anything about this in the changelog. In NSX versions 3.X and 4.2.1 and higher, these certificates are valid for 10 years. But what exactly does that mean?\nThe Problem First of all, don’t panic. The affected certificates are not visible in the GUI, but NSX Manager will issue a warning and display an error 30 days in advance. If you don’t see these messages in your NSX, you have more than 30 days to respond. Furthermore, it only affects transport nodes deployed with NSX 4.1.x - 4.2. If you have upgraded from NSX 3.X to one of the affected versions or have just deployed VCF version 5.2.x, you are safe.\nInfo\rThe certificate issued at the time of Transport Node creation is not replaced automatically during an upgrade.\rWhy It Matters As the 825-day period approaches its end, you may encounter certificate expiration issues, potentially affecting NSX component communication and overall platform stability. Warning\rOnce the TransportNode certificate expires, there is a grace period of only 24 hours after which all impacted Edges and Hosts will be disconnected from NSX.\rIf you are affected, there are two scenarios.\nScenario A) The certificates will expire sometime in the near future, you may have received a warning in NSX Manager and therefore found my blog, or you are not yet aware of the problem because the certificates will expire sometime between 31 and 825 days from now. Scenario B) The certificates have already expired and transport nodes are disconnected from NSX. There is a solution for both scenarios. But let’s start with the simple scenario A first.\nFind the problem If you don’t know which NSX version you installed and want to check whether you are affected by this issue, Broadcom has a relatively simple solution. There is a script called CARR (Certificate Analyzer, Results and Recovery) that can be easily run on NSX Manager (NSX 4.1.x to 4.2) or on an external client (other NSX versions). Download Certificate Analyzer, Results and Recovery (CARR)from the official KB article.\nIn all cases, the script requires the following ports to be open between the client machine and the 3 NSX Managers\nssh port 22 https port 443 corfu port 9000 If running on the NSX Manager directly, ports 443 and 9000 will already be open between the 3 Managers.\nIf you want to run the script on the NSX manager, then the script must be executed directly from the /root directory. To do this, copy the script to your NSX Manager or Global NSX Manager using sftp and unzip it with tar and run the script.\ntar -xvf carr-1.15.tar.gz cd carr-1.15 ./start.sh -d Warning\rThe CARR script supports multiple parameters. Always perform an NSX backup first and, above all, run the script in dryrun mode. Dryrun mode executes the script in read-only mode.\rScript options:\n-o = this flag is used to force online mode\n-t = specify lead time for expiring certificates, between 31 and 825 days.\n-d = dryrun\nI ran the script with the default settings (lead time for expiring 825 days) and the output was as follows:\nCARR Script Validation Report Certificate Checks Validation Results Probable Fix API WARNING: Certificate is expiring in 680 daysSUCCESS: 10.28.0.3 Certificate is CA signed. Customer should import the new CA signed certificate. VIP WARNING: Certificate is expiring in 680 daysSUCCESS: 10.28.0.3 Certificate is CA signed. Customer should import the new CA signed certificate. STALE-CERTIFICATES SUCCESS: No stale certificates found. APH_AR SUCCESS: 10.28.0.3 COMPUTE_MANAGER VC(CM): vcf02-vcsa.lab.home: SUCCESS: No issue with certificates found. LOCAL-MANAGER-PI The NSX-manager is not federated. Skipping Local Manager cert validations SITE-TO-SITE The NSX-manager is not federated. Skipping APH_AR cert validations HOST No Host certificate is expiring or has expired EDGE No EDGE node certificate is expiring or has expired CCP SUCCESS: 10.28.0.3 APH_TN SUCCESS: 10.28.0.3 CBM_CLUSTER_MANAGER SUCCESS: 10.28.0.3 CBM_CORFU SUCCESS: 10.28.0.3 All validations done.\nAs you can see from the output for HOST and EDGE, my installation is not affected. However, it shows that my API and VIP certificate will expire in 680 days. CARR is also smart enough to recognize that it is a certificate signed by a CA and not a certificate issued by NSX itself.\nWarning\rIf I hadn’t run the script in dry run mode, the script would have replaced my API and VIP certificates from NSX Manager with its own self-signed certificates. However, this is not desirable in this case. Caution is advised here, as it is easy to accidentally replace certificates that you do not want to replace.\rTo trigger TN cert replacement, environment details must be populated in a pre-existing file validation_config.yaml. This yaml file is located in the same folder as start.sh. My example yaml. I have disabled validation of all certificates except HOST and EDGE.\n# user interface to provide the validation config # user can specify if any certificate validation needs to be skipped. # by default all certificate types will be validated. # For Hosts , the vCenter cluster names for host must be specified. Script will validate hosts in those clusters only. # For Edge node, Edge cluster name must be specified. Script will validate edge nodes in those clusters only. HOST: validate: True clusters: - vcenter_name: vcf02-vcsa.lab.home vcenter_cluster_name: sfo-m01-cluster-001 EDGE: validate: True clusters: - name: cl01 API: validate: False VIP: validate: False CBM-FILE-PERMISSIONS: validate: False CBM_CORFU: validate: False CBM_CLUSTER_MANAGER: validate: False CORFU_SERVER: validate: False CORFU_CLIENTS: validate: False LOCAL-MANAGER-PI: validate: False GLOBAL-MANAGER-PI: validate: False STALE-CERTIFICATES: validate: False APH_TN: validate: False APH_AR: validate: False CCP: validate: False SITE-TO-SITE: validate: False COMPUTE_MANAGER: validate: False When I now run the script without dry run, I see in the output that all certificates except HOST and EDGE are skipped. This effectively prevents certificates that you do not want to exchange from being exchanged.\nCARR Script Validation Report Certificate Checks Validation Results Probable Fix API Validation for the ‘API’ is disabled in the input config file VIP Validation for the ‘VIP’ is disabled in the input config file STALE-CERTIFICATES Validation for the ‘STALE-CERTIFICATES’ is disabled in the input config file APH_AR Validation for the ‘APH_AR’ is disabled in the input config file COMPUTE_MANAGER Validation for the ‘COMPUTE_MANAGER’ is disabled in the input config file LOCAL-MANAGER-PI Validation for the ‘LOCAL-MANAGER-PI’ is disabled in the input config file SITE-TO-SITE Validation for the ‘SITE-TO-SITE’ is disabled in the input config file HOST No Host certificate is expiring or has expired EDGE No EDGE node certificate is expiring or has expired CCP Validation for the ‘CCP’ is disabled in the input config file APH_TN Validation for the ‘APH_TN’ is disabled in the input config file CBM_CLUSTER_MANAGER Validation for the ‘CBM_CLUSTER_MANAGER’ is disabled in the input config file CBM_CORFU Validation for the ‘CBM_CORFU’ is disabled in the input config file What to do if the transport nodes are already disconnected? There is a solution for this as well. Unfortunately, CARR can no longer be used for separate transport nodes. The solution to this problem is to manually generate new certificates on the transport node and then push them from the transport node to the NSX Manager.\nWarning\rIn general, caution is advised when undertaking this task. Personally, I would always open a ticket with Broadcom, as errors can cause further damage in case of doubt. If an Edge Node is disconnected, you can also perform a redeployment via API, which may even be faster than troubleshooting with CARR or manually. You can find out how to do this in my blog here: SDN-warrior - NSX Edge Redeploy Guide\rSSH to the Transport Node as root user\nEmpty Transport Node certificate and private key\ncat /dev/null \u003e /etc/vmware/nsx/host-cert.pem cat /dev/null \u003e /etc/vmware/nsx/host-privkey.pem Generate a new self-signed TN certificate and key. For NSX 4.1.x versions prior to 4.1.2.5: Create a temporary openssl config file from the existing openssl config cat /etc/vmware/nsx/openssl-proxy.cnf \u003e /tmp/tmp-openssl-proxy.cnf UUID is extracted and added to the temporary openssl config echo \"UID = $(grep -o '[^\u003c]*' /etc/vmware/nsx/host-cfg.xml | sed 's///')\" \u003e\u003e /tmp/tmp-openssl-proxy.cnf Add extension in the temporary openssl config echo -e \"[ req_ext ]\\nbasicConstraints = CA:FALSE\\nextendedKeyUsage = clientAuth\\nsubjectKeyIdentifier = hash\\nauthorityKeyIdentifier = keyid,issuer\" \u003e\u003e /tmp/tmp-openssl-proxy.cnf Replace the certificate, where below -days parameter specifies 3650 days (10 years) validity period openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -keyout /etc/vmware/nsx/host-privkey.pem -out /etc/vmware/nsx/host-cert.pem -config /tmp/tmp-openssl-proxy.cnf -extensions req_ext For NSX 4.1.2.5 and higher restarting nsx-proxy restart creates the new cert-key pair: /etc/init.d/nsx-proxy restart Identify NSX Manager thumbprint, ssh as admin user to NSX Manager get certificate api thumbprint To push the new cert-key pair to the Manager, from root user on the Host or Edge run (Any NSX Manager name or IP can be used)\nEdge su admin -c push host-certificate username admin thumbprint Password for API user: Host nsxcli -c push host-certificate username admin thumbprint Password for API user: The official Broadcom KB article can be found here: Broadcom: Alarm For Transport Node Certificate is About to Expire.\nConclusion At first glance, this problem sounds quite drastic, but if you have monitoring in place and regularly check the status of your NSX installation, the outage can be avoided relatively easily. The most important thing to know, however, is that upgrading your NSX version does not extend existing certificate lifetimes!\n",
    "wordCount" : "1591",
    "inLanguage": "en",
    "image":"http://localhost:1313/images/disc.jpg","datePublished": "2025-05-06T18:00:00+02:00",
    "dateModified": "2025-05-06T18:00:00+02:00",
    "author":{
        "@type": "Person",
        "name": "SDN-Warrior",
        "url": "http://localhost:1313/about/"
        },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "http://localhost:1313/posts/nsx-expiring-tn-certificates/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "SDN-Warrior | Daniel Krieger",
      "description": "",
      "logo": {
        "@type": "ImageObject",
        "url": "http://localhost:1313/favicon.ico"
      }
    }
}
</script><title>NSX Expiring Transport Node Certificates</title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="http://localhost:1313/css/style.min.691b64f928c4a491d4338d0d411ad2bbba09852f74d2784509a03c109a91be56.css" integrity="sha256-aRtk+SjEpJHUM40NQRrSu7oJhS900nhFCaA8EJqRvlY=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/images/disc.jpg');}</style></head>
<body id="page">
	<header id="site-header">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="http://localhost:1313/">SDN-Warrior | Daniel Krieger</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="http://localhost:1313/posts/">Posts</a><a href="http://localhost:1313/lab-bom/">Lab BOM</a><a href="http://localhost:1313/links/">Links</a><a href="http://localhost:1313/about/">About Me</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
   </svg></button><span class="hdr-links hide-in-mobile"><a href="https://de.linkedin.com/in/daniel-krieger-6476591a9" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2">
      <circle cx="18" cy="5" r="3"></circle>
      <circle cx="6" cy="12" r="3"></circle>
      <circle cx="18" cy="19" r="3"></circle>
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
   </svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fnsx-expiring-tn-certificates%2f&amp;text=NSX%20Expiring%20Transport%20Node%20Certificates" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6" />
</svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fnsx-expiring-tn-certificates%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg></a>
        </li>
        <li>
            <a href="mailto:?subject=NSX%20Expiring%20Transport%20Node%20Certificates&amp;body=http%3a%2f%2flocalhost%3a1313%2fposts%2fnsx-expiring-tn-certificates%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
   <polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fnsx-expiring-tn-certificates%2f&amp;source=http%3a%2f%2flocalhost%3a1313%2f&amp;title=NSX%20Expiring%20Transport%20Node%20Certificates&amp;summary=NSX%20Expiring%20Transport%20Node%20Certificates%2c%20by%20SDN-Warrior%0a%0aOn%20versions%20NSX%204.1.x%20and%204.2.0%2c%20Edge%20and%20Host%20Transport%20Nodes%20are%20instantiated%20using%20a%20certificate%20with%20validity%20period%20of%20825%20days.%20NSX-T%203.x%20and%20NSX%204.2.1%20and%20higher%20create%20Transport%20Nodes%20using%20a%20certificate%20with%20validity%20period%20of%2010%20years.%20The%20Transport%20Node%20certificate%20used%20at%20create%20time%20is%20not%20replaced%20on%20upgrade.%20Any%20Edge%20that%20may%20have%20been%20deployed%20on%20these%20versions%20or%20any%20Hosts%20prepared%20or%20re-prepared%20on%20these%20versions%20will%20have%20this%20shorter%20validity%20period%20certificate.%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;NSX Expiring Transport Node Certificates&#34;,&#34;http://localhost:1313/posts/nsx-expiring-tn-certificates/&#34;,&#34;NSX Expiring Transport Node Certificates, by SDN-Warrior\n\nOn versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
   </svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
   </svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="http://localhost:1313/posts/">Posts</a></li>
			<li><a href="http://localhost:1313/lab-bom/">Lab BOM</a></li>
			<li><a href="http://localhost:1313/links/">Links</a></li>
			<li><a href="http://localhost:1313/about/">About Me</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>May 6, 2025</span></div>
				<h1>NSX Expiring Transport Node Certificates</h1>
			</header>
			<div class="post-info"><p>On versions NSX 4.1.x and 4.2.0, Edge and Host Transport Nodes are instantiated using a certificate with validity period of 825 days. NSX-T 3.x and NSX 4.2.1 and higher create Transport Nodes using a certificate with validity period of 10 years. The Transport Node certificate used at create time is not replaced on upgrade. Any Edge that may have been deployed on these versions or any Hosts prepared or re-prepared on these versions will have this shorter validity period certificate.</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
   stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather">
   <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
   <line x1="16" y1="8" x2="2" y2="22"></line>
   <line x1="17.5" y1="15" x2="9" y2="15"></line>
</svg><a href="/about/" target="_blank">SDN-Warrior</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
      <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
      <line x1="7" y1="7" x2="7" y2="7"></line>
   </svg><span class="tag"><a href="http://localhost:1313/tags/nsx">nsx</a></span><span class="tag"><a href="http://localhost:1313/tags/vmware">vmware</a></span><span class="tag"><a href="http://localhost:1313/tags/homelab">homelab</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
   </svg>1591 Words
     // ReadTime
    
    
    
    7 Minutes, 13 Seconds</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
   </svg>2025-05-06 18:00 &#43;0200</p></div>
			<hr class="post-end">
			<div class="content">
				<h2 id="introduction">Introduction<a href="#introduction" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>In NSX versions <strong>4.1.x</strong> and <strong>4.2.0</strong>, <strong>edge transport nodes</strong> and <strong>host transport nodes</strong> are instantiated using certificates with a <strong>validity period of only 825 days</strong>.
This is obviously not desirable behavior and has been fixed in newer versions of NSX. Interestingly, I haven&rsquo;t seen anything about this in the changelog.
In NSX versions 3.X and 4.2.1 and higher, these certificates are valid for 10 years. But what exactly does that mean?</p>
<h2 id="the-problem">The Problem<a href="#the-problem" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>First of all, don&rsquo;t panic. The affected certificates are not visible in the GUI, but NSX Manager will issue a warning and display an error 30 days in advance. If you don&rsquo;t see these messages in your NSX, you have more than 30 days to respond.
Furthermore, it only affects transport nodes deployed with NSX 4.1.x - 4.2. If you have upgraded from NSX 3.X to one of the affected versions or have just deployed VCF version 5.2.x, you are safe.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">The certificate issued at the time of Transport Node creation <strong>is not replaced automatically during an upgrade</strong>.</div>
    </aside>
<h2 id="why-it-matters">Why It Matters<a href="#why-it-matters" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>As the 825-day period approaches its end, you may encounter <strong>certificate expiration issues</strong>, potentially affecting NSX component communication and overall platform stability.

    <aside class="admonition Warning">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Warning</b>
        </div>
        <div class="admonition-content">Once the TransportNode certificate expires, there is a grace period of only 24 hours after which all impacted Edges and Hosts will be disconnected from NSX.</div>
    </aside></p>
<p>If you are affected, there are two scenarios.</p>
<ul>
<li>Scenario A) The certificates will expire sometime in the near future, you may have received a warning in NSX Manager and therefore found my blog, or you are not yet aware of the problem because the certificates will expire sometime between 31 and 825 days from now.</li>
<li>Scenario B) The certificates have already expired and transport nodes are disconnected from NSX.</li>
</ul>
<p>There is a solution for both scenarios. But let&rsquo;s start with the simple scenario A first.</p>
<h2 id="find-the-problem">Find the problem<a href="#find-the-problem" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>If you don&rsquo;t know which NSX version you installed and want to check whether you are affected by this issue, Broadcom has a relatively simple solution. There is a script called CARR (Certificate Analyzer, Results and Recovery) that can be easily run on NSX Manager (NSX 4.1.x to 4.2) or on an external client (other NSX versions).
Download <a href="https://knowledge.broadcom.com/external/article/369034">Certificate Analyzer, Results and Recovery (CARR)</a>from the official KB article.</p>
<p>In all cases, the script requires the following ports to be open between the client machine and the 3 NSX Managers</p>
<ul>
<li>ssh port 22</li>
<li>https port 443</li>
<li>corfu port 9000</li>
</ul>
<p>If running on the NSX Manager directly, ports 443 and 9000 will already be open between the 3 Managers.</p>
<p>If you want to run the script on the NSX manager, then the script must be executed directly from the /root directory.
To do this, copy the script to your NSX Manager or Global NSX Manager using sftp and unzip it with tar and run the script.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">tar -xvf carr-1.15.tar.gz
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> carr-1.15
</span></span><span class="line"><span class="cl">./start.sh -d
</span></span></code></pre></div>
    <aside class="admonition Warning">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Warning</b>
        </div>
        <div class="admonition-content">The CARR script supports multiple parameters. Always perform an NSX backup first and, above all, run the script in dryrun mode. Dryrun mode executes the script in read-only mode.</div>
    </aside>
<p>Script options:</p>
<ul>
<li>
<p>-o = this flag is used to force online mode</p>
</li>
<li>
<p>-t = specify lead time for expiring certificates, between 31 and 825 days.</p>
</li>
<li>
<p>-d = dryrun</p>
</li>
</ul>
<p>I ran the script with the default settings (lead time for expiring 825 days) and the output was as follows:</p>
<h3 id="carr-script-validation-report">CARR Script Validation Report<a href="#carr-script-validation-report" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<table>
  <thead>
      <tr>
          <th>Certificate Checks</th>
          <th>Validation Results</th>
          <th>Probable Fix</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>API</td>
          <td>WARNING: Certificate is expiring in 680 days<!-- raw HTML omitted -->SUCCESS: 10.28.0.3</td>
          <td>Certificate is CA signed. Customer should import the new CA signed certificate.</td>
      </tr>
      <tr>
          <td>VIP</td>
          <td>WARNING: Certificate is expiring in 680 days<!-- raw HTML omitted -->SUCCESS: 10.28.0.3</td>
          <td>Certificate is CA signed. Customer should import the new CA signed certificate.</td>
      </tr>
      <tr>
          <td>STALE-CERTIFICATES</td>
          <td>SUCCESS: No stale certificates found.</td>
          <td></td>
      </tr>
      <tr>
          <td>APH_AR</td>
          <td>SUCCESS: 10.28.0.3</td>
          <td></td>
      </tr>
      <tr>
          <td>COMPUTE_MANAGER</td>
          <td>VC(CM): vcf02-vcsa.lab.home: SUCCESS: No issue with certificates found.</td>
          <td></td>
      </tr>
      <tr>
          <td>LOCAL-MANAGER-PI</td>
          <td>The NSX-manager is not federated. Skipping Local Manager cert validations</td>
          <td></td>
      </tr>
      <tr>
          <td>SITE-TO-SITE</td>
          <td>The NSX-manager is not federated. Skipping APH_AR cert validations</td>
          <td></td>
      </tr>
      <tr>
          <td>HOST</td>
          <td>No Host certificate is expiring or has expired</td>
          <td></td>
      </tr>
      <tr>
          <td>EDGE</td>
          <td>No EDGE node certificate is expiring or has expired</td>
          <td></td>
      </tr>
      <tr>
          <td>CCP</td>
          <td>SUCCESS: 10.28.0.3</td>
          <td></td>
      </tr>
      <tr>
          <td>APH_TN</td>
          <td>SUCCESS: 10.28.0.3</td>
          <td></td>
      </tr>
      <tr>
          <td>CBM_CLUSTER_MANAGER</td>
          <td>SUCCESS: 10.28.0.3</td>
          <td></td>
      </tr>
      <tr>
          <td>CBM_CORFU</td>
          <td>SUCCESS: 10.28.0.3</td>
          <td></td>
      </tr>
  </tbody>
</table>
<p><em>All validations done.</em></p>
<p>As you can see from the output for HOST and EDGE, my installation is not affected. However, it shows that my API and VIP certificate will expire in 680 days. CARR is also smart enough to recognize that it is a certificate signed by a CA and not a certificate issued by NSX itself.</p>

    <aside class="admonition Warning">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Warning</b>
        </div>
        <div class="admonition-content">If I hadn&rsquo;t run the script in dry run mode, the script would have replaced my API and VIP certificates from NSX Manager with its own self-signed certificates. However, this is not desirable in this case. Caution is advised here, as it is easy to accidentally replace certificates that you do not want to replace.</div>
    </aside>
<p>To trigger TN cert replacement, environment details must be populated in a pre-existing file validation_config.yaml. This yaml file is located in the same folder as start.sh.
My example yaml. I have disabled validation of all certificates except HOST and EDGE.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># user interface to provide the validation config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># user can specify if any certificate validation needs to be skipped.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># by default all certificate types will be validated.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># For Hosts , the vCenter cluster names for host must be specified. Script will validate hosts in those clusters only.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># For Edge node, Edge cluster name must be specified. Script will validate edge nodes in those clusters only.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">HOST</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">vcenter_name</span><span class="p">:</span><span class="w"> </span><span class="l">vcf02-vcsa.lab.home</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">vcenter_cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l">sfo-m01-cluster-001</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">EDGE</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">True</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusters</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cl01</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">API</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">VIP</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CBM-FILE-PERMISSIONS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CBM_CORFU</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CBM_CLUSTER_MANAGER</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CORFU_SERVER</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CORFU_CLIENTS</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">LOCAL-MANAGER-PI</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">GLOBAL-MANAGER-PI</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">STALE-CERTIFICATES</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">APH_TN</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">APH_AR</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">CCP</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">SITE-TO-SITE</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">COMPUTE_MANAGER</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">validate</span><span class="p">:</span><span class="w"> </span><span class="kc">False</span><span class="w">
</span></span></span></code></pre></div><p>When I now run the script without dry run, I see in the output that all certificates except HOST and EDGE are skipped. This effectively prevents certificates that you do not want to exchange from being exchanged.</p>
<h3 id="carr-script-validation-report-1">CARR Script Validation Report<a href="#carr-script-validation-report-1" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<table>
  <thead>
      <tr>
          <th>Certificate Checks</th>
          <th>Validation Results</th>
          <th>Probable Fix</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>API</td>
          <td>Validation for the &lsquo;API&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>VIP</td>
          <td>Validation for the &lsquo;VIP&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>STALE-CERTIFICATES</td>
          <td>Validation for the &lsquo;STALE-CERTIFICATES&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>APH_AR</td>
          <td>Validation for the &lsquo;APH_AR&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>COMPUTE_MANAGER</td>
          <td>Validation for the &lsquo;COMPUTE_MANAGER&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>LOCAL-MANAGER-PI</td>
          <td>Validation for the &lsquo;LOCAL-MANAGER-PI&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>SITE-TO-SITE</td>
          <td>Validation for the &lsquo;SITE-TO-SITE&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>HOST</td>
          <td>No Host certificate is expiring or has expired</td>
          <td></td>
      </tr>
      <tr>
          <td>EDGE</td>
          <td>No EDGE node certificate is expiring or has expired</td>
          <td></td>
      </tr>
      <tr>
          <td>CCP</td>
          <td>Validation for the &lsquo;CCP&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>APH_TN</td>
          <td>Validation for the &lsquo;APH_TN&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>CBM_CLUSTER_MANAGER</td>
          <td>Validation for the &lsquo;CBM_CLUSTER_MANAGER&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
      <tr>
          <td>CBM_CORFU</td>
          <td>Validation for the &lsquo;CBM_CORFU&rsquo; is disabled in the input config file</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h2 id="what-to-do-if-the-transport-nodes-are-already-disconnected">What to do if the transport nodes are already disconnected?<a href="#what-to-do-if-the-transport-nodes-are-already-disconnected" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>There is a solution for this as well. Unfortunately, CARR can no longer be used for separate transport nodes. The solution to this problem is to manually generate new certificates on the transport node and then push them from the transport node to the NSX Manager.</p>

    <aside class="admonition Warning">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Warning</b>
        </div>
        <div class="admonition-content">In general, caution is advised when undertaking this task. Personally, I would always open a ticket with Broadcom, as errors can cause further damage in case of doubt. If an Edge Node is disconnected, you can also perform a redeployment via API, which may even be faster than troubleshooting with CARR or manually.
You can find out how to do this in my blog here: <a href="https://sdn-warrior.org/posts/nsx-edge-redeploy/">SDN-warrior - NSX Edge Redeploy Guide</a></div>
    </aside>
<ul>
<li>
<p>SSH to the Transport Node as root user</p>
</li>
<li>
<p>Empty Transport Node certificate and private key</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">cat /dev/null &gt; /etc/vmware/nsx/host-cert.pem
</span></span><span class="line"><span class="cl">cat /dev/null &gt; /etc/vmware/nsx/host-privkey.pem
</span></span></code></pre></div><ul>
<li>Generate a new self-signed TN certificate and key.</li>
</ul>
<h4 id="for-nsx-41x-versions-prior-to-4125">For NSX 4.1.x versions prior to 4.1.2.5:<a href="#for-nsx-41x-versions-prior-to-4125" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<ul>
<li>Create a temporary openssl config file from the existing openssl config</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">cat /etc/vmware/nsx/openssl-proxy.cnf &gt; /tmp/tmp-openssl-proxy.cnf
</span></span></code></pre></div><ul>
<li>UUID is extracted and added to the temporary openssl config</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">echo &#34;UID = $(grep -o &#39;&lt;uuid&gt;[^&lt;]*&#39; /etc/vmware/nsx/host-cfg.xml | sed &#39;s/&lt;uuid&gt;//&#39;)&#34; &gt;&gt; /tmp/tmp-openssl-proxy.cnf
</span></span></code></pre></div><ul>
<li>Add extension in the temporary openssl config</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">echo -e &#34;[ req_ext ]\nbasicConstraints     = CA:FALSE\nextendedKeyUsage     = clientAuth\nsubjectKeyIdentifier = hash\nauthorityKeyIdentifier = keyid,issuer&#34; &gt;&gt; /tmp/tmp-openssl-proxy.cnf
</span></span></code></pre></div><ul>
<li>Replace the certificate, where below -days parameter specifies 3650 days (10 years) validity period</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">openssl req -new -newkey rsa:2048 -days 3650 -nodes -x509 -keyout /etc/vmware/nsx/host-privkey.pem -out /etc/vmware/nsx/host-cert.pem -config /tmp/tmp-openssl-proxy.cnf -extensions req_ext
</span></span></code></pre></div><h4 id="for-nsx-4125-and-higher">For NSX 4.1.2.5 and higher<a href="#for-nsx-4125-and-higher" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<ul>
<li>restarting nsx-proxy restart creates the new cert-key pair:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">/etc/init.d/nsx-proxy restart
</span></span></code></pre></div><ul>
<li>Identify NSX Manager thumbprint, ssh as admin user to NSX Manager</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">get certificate api thumbprint
</span></span></code></pre></div><p>To push the new cert-key pair to the Manager, from root user on the Host or Edge run (Any NSX Manager name or IP can be used)</p>
<h4 id="edge">Edge<a href="#edge" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">su admin -c push host-certificate &lt;Manager hostname-or-IP&gt; username admin thumbprint &lt;thumbprint from step 4&gt;
</span></span><span class="line"><span class="cl">Password for API user: &lt;enter admin password&gt;
</span></span></code></pre></div><h4 id="host">Host<a href="#host" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">nsxcli -c push host-certificate &lt;Manager hostname-or-IP&gt; username admin thumbprint &lt;thumbprint from step 4&gt;
</span></span><span class="line"><span class="cl">Password for API user: &lt;enter admin password&gt;
</span></span></code></pre></div><p>The official Broadcom KB article can be found here: <a href="https://knowledge.broadcom.com/external/article/345802/alarm-for-transport-node-certificate-is.html">Broadcom: Alarm For Transport Node Certificate is About to Expire.</a></p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>At first glance, this problem sounds quite drastic, but if you have monitoring in place and regularly check the status of your NSX installation, the outage can be avoided relatively easily. The most important thing to know, however, is that upgrading your NSX version does <strong>not</strong> extend existing certificate lifetimes!</p>

			</div>
			
			<div class="post-divider">
  				<img src="/end.png" alt="End graphic" loading="lazy">
			</div>

<div class="related-posts thin">
	<h2>See Also</h2>
	<ul>
	
	<li><a href="/posts/vcf-single-nsx/">VCF Quick Tip - WLD with single NSX Manager</a></li>
	
	<li><a href="/posts/vcf-stretched-cluster/">VCF Stretched Cluster</a></li>
	
	<li><a href="/posts/vcf-import-overlay/">VCF Import Tool - Enable Overlay in an imported VCF Domain</a></li>
	
	<li><a href="/posts/vcf-import-cluster/">VCF Import Tool - Run VCF with NFS as principal Storage </a></li>
	
	<li><a href="/posts/nsx-apply-to/">How Apply To works in NSX DFW</a></li>
	
	</ul>
</div>

		</article>
		<div class="post-nav thin">
			<a class="next-post" href="http://localhost:1313/posts/restnsx-with-hcx/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
   </svg>&nbsp;Newer</span><br><span>ReSTNSX with HCX</span>
			</a>
			<a class="prev-post" href="http://localhost:1313/posts/vmug-connect-stl-2025/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right">
      <line x1="5" y1="12" x2="19" y2="12"></line>
      <polyline points="12 5 19 12 12 19"></polyline>
   </svg></span><br><span>VMUG Connect St. Louis 2025</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2025 <a href="http://localhost:1313/">SDN-Warrior</a>
		&#183; COPYRIGHT Daniel Krieger</p>

<script defer src="/klaro/klaro-config.js"></script>

<script defer src="/klaro/klaro.js"></script>
</footer>
<script async src="http://localhost:1313/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js" integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin="anonymous"></script><script async src="http://localhost:1313/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js" integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin="anonymous"></script>
</body>

</html>
