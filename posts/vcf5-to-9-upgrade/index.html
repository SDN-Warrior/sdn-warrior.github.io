

<!DOCTYPE html>
<html lang="en-us">
<head>
<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics">
  // Hier kommt dein GA-Code (Google Analytics 4 empfohlen!)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNTG7NNKQN', { 'anonymize_ip': true });
</script>

<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics" src="https://www.googletagmanager.com/gtag/js?id=G-YNTG7NNKQN"></script>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow"><link rel="author" href="/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="SDN-Warrior"><meta name="description" content="A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.">

  <meta itemprop="name" content="VCF9 -  VCF5.X to VCF9 upgrade">
  <meta itemprop="description" content="A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.">
  <meta itemprop="datePublished" content="2025-09-07T23:00:08+02:00">
  <meta itemprop="dateModified" content="2025-09-07T23:00:08+02:00">
  <meta itemprop="wordCount" content="2082">
  <meta itemprop="image" content="https://sdn-warrior.org/images/preview.png">
  <meta itemprop="keywords" content="Vcf,Vcf9,Sddc,Upgrade"><meta property="og:url" content="https://sdn-warrior.org/posts/vcf5-to-9-upgrade/">
  <meta property="og:site_name" content="SDN-Warrior | Daniel Krieger">
  <meta property="og:title" content="VCF9 -  VCF5.X to VCF9 upgrade">
  <meta property="og:description" content="A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-07T23:00:08+02:00">
    <meta property="article:modified_time" content="2025-09-07T23:00:08+02:00">
    <meta property="article:tag" content="Vcf">
    <meta property="article:tag" content="Vcf9">
    <meta property="article:tag" content="Sddc">
    <meta property="article:tag" content="Upgrade">
    <meta property="og:image" content="https://sdn-warrior.org/images/preview.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://sdn-warrior.org/images/preview.png">
  <meta name="twitter:title" content="VCF9 -  VCF5.X to VCF9 upgrade">
  <meta name="twitter:description" content="A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "VCF9 -  VCF5.X to VCF9 upgrade",
    "name": "VCF9 -  VCF5.X to VCF9 upgrade",
    "description": "A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.",
    "keywords": ["vcf", "vcf9", "sddc", "upgrade"],
    "articleBody": "Introduction I have been asked several times on LinkedIn for an article on the topic of brownfield upgrades from VCF 5 to VCF 9. Well, here we are. I thought it would be relatively easy and that you could just click your way through, but I was wrong. But let’s start at the beginning.\nAs things stand at the moment, if you have NSX version newer then 4.2.1.3 in your VCF environment, here’s the bad news—it’s not possible as of today. NSX 4.2.1.4 and newer has a newer code base than NSX 9.0.0.0 and is therefore not compatible. The problem should be fixed with VCF 9.0.1.\nInteroperability Matrix (click to enlarge)\nIt is best to always check the Product Interoperability Matrix for this.\nSince my last available VCF 5 lab was unfortunately already patched to the latest NSX version, I had no choice but to deploy a fresh VCF 5.2.1, as the NSX version here is low enough. And oh my God, I really didn’t miss the Excel or Json deployment of VCF 5.X, but for my readers’ sake, I’ll struggle through it once again.\nInfo\rI will only deploy one management domain in VCF 5.2.1, and I will also skip deploying the edge VMs. However, this does not matter, as you always have to upgrade the management domain first, and the workload domains will function the same way afterwards.\rManagement domain and basic setup I have deployed a management domain with 4 ESXi servers and vSAN. I have set up the whole thing in a nested configuration. Since the SDDC Manager does not yet support download tokens, I used the VMwareDepotChange script. I have already covered this process in my blog.\nSoftware Component Version Date Build Number Cloud Builder VM 5.2.1 09 OCT 2024 24307856 SDDC Manager 5.2.1 09 OCT 2024 24307856 VMware vCenter Server Appliance 8.0 Update 3c 09 OCT 2024 24305161 VMware ESXi 8.0 Update 3b 17 SEP 2024 24280767 VMware NSX 4.2.1 09 OCT 2024 24304122 Info\rI am not deploying Operations because I will integrate the VCF installation into my existing VCF 9 Operations later, after the upgrade.\rAfter the initial deployment, I updated the SDDC to version 5.2.1.1, as it contained several bug fixes. Finally, I took a snapshot of the SDDC Manager, and we were ready to go.\nInfo\rBroadcom has published a KB article on the update sequence for VCF9. Feel free to take a look at it. Depending on which VCF components you are using, you may need to take other steps beforehand.\rUprade SDDC In my setup, the first step is to upgrade the SDDC Manager. As I mentioned above, after the upgrade, the setup will be added to my VCF Operations, which is already up to date.\nSDDC Manager upgrade (click to enlarge)\nThe process is relatively straightforward. The 2 GB of data must be downloaded from the network via the SDDC, after which the upgrade can be initiated.\nSDDC Manager upgrade status (click to enlarge)\nThe SDDC is booted once during the upgrade. I had a minor problem with the SDDC in that it no longer displayed the upgrade status after rebooting. Instead, I only saw update status 0. I checked the log file /var/log/vmware/capengine/cap-update/workflow.log via SSH on the SDDC manager and looked to see if the following was visible:\nYYYY-MM-DDTHH:MM:SS.426528 workflow_manager.go:221: Task stage-cleanup completed YYYY-MM-DDTHH:MM:SS.426646 workflow_manager.go:183: All tasks finished for workflow YYYY-MM-DDTHH:MM:SS.426699 workflow_manager.go:354: Updating instance status to Completed After that, I rebooted the SDDC again and the error was fixed. I had never had this problem before and couldn’t find any KB articles about it. Maybe my nested environment was too slow. So take this fix with a grain of salt. Finally, I configured my VCF9 offline repo in the SDDC as a repository, as I don’t want to download all the VCF9 binaries from the network.\nBinary Management SDDC version 9 supports the Broadcom download token, so there is no need to change anything with a script on the SDDC, but I prefer my central offline repo. I built my own repo with the help of Timo Sugliani’s instructions. It is the easiest way to get your own offline repo, even if you have no Linux knowledge. However, you still need a valid download token.\nBinary Management (click to enlarge)\nNext, I download the upgrade binaries for NSX, vCenter, and ESX to my SDDC manager. The download is faster than the validation. It took me about 30 minutes to get everything I needed.\nStarting the upgrade I start the upgrade with the SDDC for the management domain. To do this, go to Workload Domains —\u003e Management Domain —\u003e Updates in the SDDC manager and then click on the Plan Upgrades button. The process is actually exactly the same as for a normal VCF update.\nPlan Upgrade (click to enlarge)\nI select VCF version 9.0.0.0 as the target version and confirm the version summary.\nVersion summary (click to enlarge)\nThis completes the upgrade plan. It is important to note that the SDDC will only start the upgrade once we have clicked Configure Update. The order of the components is as follows:\nNSX vCenter ESX hosts vSAN You can only configure the update for one component at a time. Pre-checks must be performed before each update. Here, too, the process is no different from a normal VCF update.\nInfo\rSince I have a nested VCF setup with vSAN, there will be some errors. However, these can be ignored.\rNSX Since I don’t have any edges deployed, the NSX upgrade runs without any problems. If I had edge VMs in my environment, I would have had to intervene because of the Ryzen processors, otherwise the edge upgrade would have failed. I explained why this is the case in my article on MS-A2.\nvCenter Next up is the vCenter. Here, the vCenter Reduced Downtime Update is used. This means that a second vCenter appliance is deployed in parallel and assigned a temporary IP address. There are two options here: either I assign a static temporary IP address or I use Auto.\nI usually use IP addresses defined by my customers, as firewalls are usually involved in whatever form. Since I am working here in my lab without a firewall within the lab, I can use auto. This gives the old and new vCenter a temporary APIPA IP to communicate with each other. For the upgrade scheduler, I use Immediate and Automatic for the switchover.\nvCenter update (click to enlarge)\nESX - Houston, we have a problem! The update ran successfully, but I have the problem that my vCenter simply does not want to display ESX9 images, which is essential because without ESX9 images, you cannot upgrade the ESX servers to 9. I thought I was being clever and forced the vCenter to search for new images. You can do this using the deprecated vCenter Lifecycle Manager and push Sync Updates.\nvCenter Lifecycle Manager (click to enlarge)\nInterestingly, the process is not running correctly. I hadn’t encountered this before, and after a quick check in the task log in vCenter, I saw the following error message, which wasn’t really helpful.\nA general system error occurred: Down load patch definitions task failed while synci ng depots. Error: 'integrity.fault.Vclntegrityf ault: VMware Sphere Lifecycle Manager hi d an unknown error. Check the events and I og files for details. vCenter Tasks (click to enlarge)\nOf course, there is nothing specific in the logs either. So Google research…Because the second most important skill in my IT career is knowing how to Google properly—maybe it’s even my most important skill.\nTurns out it’s a known bug in vCenter 9 when performing a brownfield upgrade from 8 to 9. VMware has created a KB article on this topic. The solution is relatively simple: you need to delete metadata from the vCenter DB in the tables vci_updates and vci_update_packages.\nvCenter workaround Lgin to vCenter as Root Stop updatemgr service service-control --stop updatemgr Change to ‘updatemgr’ user. su updatemgr -s /bin/bash Run psql command to patch the DB psql -U vumuser -d VCDB -c \"UPDATE vci_updates set deleted = 0, hidden = 0 where meta_uid like 'ESXi7%' or meta_uid like 'esxi7%' or meta_uid like 'ESXi_7%' or meta_uid like 'esxi_7%'; DELETE FROM vci_updates where id not in (select update_id from vci_update_packages);\" Start updatemgr service service-control --start updatemgr After the changes and the restart of the service, vCenter automatically syncs the image data. Now a new image can be created.\nvCenter Lifecycle Manager after workaround (click to enlarge)\nESX Image For Image Mode, we still need to import an image into the SDDC; without this, the ESX servers cannot be upgraded to 9. After fixing the vCenter, I create a dummy cluster in the vCenter and select the correct image for VCF9.\nAttention\rIt is important that the image from the BOM is used. For VCF9.0.0.0, this is ESX 9.0.0.0 Build 24755229. There is now a patch for ESX 9 (9.0.0.0100), but this cannot be used for the upgrade to VCF9. Instead, it must be installed via VCF 9 Operations after the upgrade to VCF9 has been successfully completed.\rThe image is then imported into the SDDC and the dummy cluster can be deleted again in vCenter. The image is assigned to the management domain cluster in the “Configure Update” step, and after the pre-checks, the ESX servers can be updated. The process ran smoothly - easy, that’s what I expected from the start.\nAttention\rBefore each update, I check vSAN Skyline Health and silence any alarms that may be present due to nested virtualization and the resulting non-certified hardware.\rvSAN The final step in the actual upgrade process is to update the vSAN storage. The process is straightforward, and all you need to do is press the upgrade button under cluster –\u003e configure –\u003e vSAN. Depending on the hardware and size of the vSAN storage, this process can take a relatively long time.\nvSAN upgrade (click to enlarge)\nNow everything is ready for me to start onboarding in Operations.\nOnboarding in VCF Operations I have a central VCF Operations because I don’t want to deploy an entire fleet every time I need a new nested lab. I described how I built it in this article. When onboarding in Operations, there are really only two things to keep in mind. I have to configure the new VCF environment as a deployment target, and I have to enable activate management, otherwise I cannot distribute licenses for the environment with my VCF Operations instance.\nTo onboard, I need to add the VCF instance to my Ops via VCF Operations —\u003e Administration —\u003e Integrations —\u003e Accounts —\u003e Vmware Cloud Foundation. Once the environment appears under Integrations, you can select it and press the Activate Management button. This allows you to assign a license to the VCF instance.\nInfo\rIt may take up to 15 minutes for the setting to become active and for VCF Operations to display the VCF instance in the licensing dialog.\rFinally, the VCF instance is set up as an deployment target under —\u003e Lifecycle —\u003e VCF Management —\u003e Settings —\u003e Deployment Targets.\nThe upgrade is now complete and the VCF 9 instance can be used as normal. Optionally, you can install the ESX patch under Lifecycle. To do this, you must create a new image in vCenter and import it via Ops. The process is more or less identical to the previous update.\nVCF Operations (click to enlarge)\nFinal thoughts The upgrade was more difficult than expected. The missing images in particular took me longer than I would like to admit. To be honest, I thought it would be a straightforward process. My VCF 5.2.1 environment was completely new, with no previous updates or other legacy issues.\nI think VCF 9.0.1 will remedy this, because in theory the upgrade process is very simple and doesn’t really differ much from a normal patch update in VCF5.X.\nWhat I still want to test is an import, i.e., converting a standalone NSX installation into a workload domain. Unfortunately, the same applies here as with my old NSX Labs: when updating my physical lab, I destroyed most of my old setups (because I’m sometimes just stupid). Only labs that are unusable in this case have survived.\nWell, I’ll do another NSX 4.2.1 deployment at some point. But that will be another blog post. If you have any questions or comments, please feel free to send me a message on LinkedIn or to my blog email address.\n",
    "wordCount" : "2082",
    "inLanguage": "en",
    "image":"https://sdn-warrior.org/images/disc.jpg","datePublished": "2025-09-07T23:00:08+02:00",
    "dateModified": "2025-09-07T23:00:08+02:00",
    "author":{
        "@type": "Person",
        "name": "SDN-Warrior",
        "url": "https://sdn-warrior.org/about/"
        },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sdn-warrior.org/posts/vcf5-to-9-upgrade/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "SDN-Warrior | Daniel Krieger",
      "description": "",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sdn-warrior.org/favicon.ico"
      }
    }
}
</script><title>VCF9 -  VCF5.X to VCF9 upgrade</title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="https://sdn-warrior.org/css/style.min.691b64f928c4a491d4338d0d411ad2bbba09852f74d2784509a03c109a91be56.css" integrity="sha256-aRtk+SjEpJHUM40NQRrSu7oJhS900nhFCaA8EJqRvlY=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/images/disc.jpg');}</style></head>
<body id="page">
	<header id="site-header">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://sdn-warrior.org/">SDN-Warrior | Daniel Krieger</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="https://sdn-warrior.org/posts/">Posts</a><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a><a href="https://sdn-warrior.org/links/">Links</a><a href="https://sdn-warrior.org/about/">About Me</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
   </svg></button><span class="hdr-links hide-in-mobile"><a href="https://de.linkedin.com/in/daniel-krieger-6476591a9" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2">
      <circle cx="18" cy="5" r="3"></circle>
      <circle cx="6" cy="12" r="3"></circle>
      <circle cx="18" cy="19" r="3"></circle>
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
   </svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf5-to-9-upgrade%2f&amp;text=VCF9%20-%20%20VCF5.X%20to%20VCF9%20upgrade" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6" />
</svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf5-to-9-upgrade%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg></a>
        </li>
        <li>
            <a href="mailto:?subject=VCF9%20-%20%20VCF5.X%20to%20VCF9%20upgrade&amp;body=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf5-to-9-upgrade%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
   <polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf5-to-9-upgrade%2f&amp;source=https%3a%2f%2fsdn-warrior.org%2f&amp;title=VCF9%20-%20%20VCF5.X%20to%20VCF9%20upgrade&amp;summary=VCF9%20-%20%20VCF5.X%20to%20VCF9%20upgrade%2c%20by%20SDN-Warrior%0a%0aA%20brief%20guide%20to%20upgrading%20from%20VCF5.X%20to%20VCF9%20on%20a%20brownfield%20site.%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;VCF9 -  VCF5.X to VCF9 upgrade&#34;,&#34;https://sdn-warrior.org/posts/vcf5-to-9-upgrade/&#34;,&#34;VCF9 -  VCF5.X to VCF9 upgrade, by SDN-Warrior\n\nA brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
   </svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
   </svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://sdn-warrior.org/posts/">Posts</a></li>
			<li><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a></li>
			<li><a href="https://sdn-warrior.org/links/">Links</a></li>
			<li><a href="https://sdn-warrior.org/about/">About Me</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Sep 7, 2025</span></div>
				<h1>VCF9 -  VCF5.X to VCF9 upgrade</h1>
			</header>
			<div class="post-info"><p>A brief guide to upgrading from VCF5.X to VCF9 on a brownfield site.</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
   stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather">
   <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
   <line x1="16" y1="8" x2="2" y2="22"></line>
   <line x1="17.5" y1="15" x2="9" y2="15"></line>
</svg><a href="/about/" target="_blank">SDN-Warrior</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
      <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
      <line x1="7" y1="7" x2="7" y2="7"></line>
   </svg><span class="tag"><a href="https://sdn-warrior.org/tags/vcf">vcf</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/vcf9">vcf9</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/sddc">sddc</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/upgrade">upgrade</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
   </svg>2082 Words
     // ReadTime
    
    
    
    9 Minutes, 27 Seconds</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
   </svg>2025-09-07 23:00 &#43;0200</p></div>
			<hr class="post-end">
			<div class="content">
				<h2 id="introduction">Introduction<a href="#introduction" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I have been asked several times on LinkedIn for an article on the topic of brownfield upgrades from VCF 5 to VCF 9.
Well, here we are. I thought it would be relatively easy and that you could just click your way through, but I was wrong.
But let&rsquo;s start at the beginning.</p>
<p>As things stand at the moment, if you have NSX version newer then 4.2.1.3 in your VCF environment, here&rsquo;s the bad news—it&rsquo;s not possible as of today.
NSX 4.2.1.4 and newer has a newer code base than NSX 9.0.0.0 and is therefore not compatible. The problem should be fixed with VCF 9.0.1.</p>

<figure><a href="01.png"><picture>
          <source srcset="/vcf5-to-vcf9/01_hu_1fe361378e33dccf.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/01_hu_b7e431a84b1e7477.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/01_hu_1fe361378e33dccf.webp"alt="Interoperability Matrix"  width="708"  height="367" />
        </picture></a><figcaption>
            <p>Interoperability Matrix (click to enlarge)</p>
          </figcaption></figure>
<p>It is best to always check the Product Interoperability Matrix for this.</p>
<p>Since my last available VCF 5 lab was unfortunately already patched to the latest NSX version, I had no choice but to deploy a fresh VCF 5.2.1, as the NSX version here is low enough.
And oh my God, I really didn&rsquo;t miss the Excel or Json deployment of VCF 5.X, but for my readers&rsquo; sake, I&rsquo;ll struggle through it once again.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">I will only deploy one management domain in VCF 5.2.1, and I will also skip deploying the edge VMs.
However, this does not matter, as you always have to upgrade the management domain first, and the workload domains will function the same way afterwards.</div>
    </aside>
<h2 id="management-domain-and-basic-setup">Management domain and basic setup<a href="#management-domain-and-basic-setup" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I have deployed a management domain with 4 ESXi servers and vSAN. I have set up the whole thing in a nested configuration.
Since the SDDC Manager does not yet support download tokens, I used the VMwareDepotChange script.
I have already covered this process in my <a href="https://sdn-warrior.org/posts/vcf-token/">blog</a>.</p>
<table>
  <thead>
      <tr>
          <th>Software Component</th>
          <th>Version</th>
          <th>Date</th>
          <th>Build Number</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Cloud Builder VM</td>
          <td>5.2.1</td>
          <td>09 OCT 2024</td>
          <td>24307856</td>
      </tr>
      <tr>
          <td>SDDC Manager</td>
          <td>5.2.1</td>
          <td>09 OCT 2024</td>
          <td>24307856</td>
      </tr>
      <tr>
          <td>VMware vCenter Server Appliance</td>
          <td>8.0 Update 3c</td>
          <td>09 OCT 2024</td>
          <td>24305161</td>
      </tr>
      <tr>
          <td>VMware ESXi</td>
          <td>8.0 Update 3b</td>
          <td>17 SEP 2024</td>
          <td>24280767</td>
      </tr>
      <tr>
          <td>VMware NSX</td>
          <td>4.2.1</td>
          <td>09 OCT 2024</td>
          <td>24304122</td>
      </tr>
  </tbody>
</table>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">I am not deploying Operations because I will integrate the VCF installation into my existing VCF 9 Operations later, after the upgrade.</div>
    </aside>
<p>After the initial deployment, I updated the SDDC to version 5.2.1.1, as it contained several bug fixes. Finally, I took a snapshot of the SDDC Manager, and we were ready to go.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">Broadcom has published a <a href="https://knowledge.broadcom.com/external/article/390634/update-sequence-for-vcf-90-and-compatibl.html">KB article</a> on the update sequence for VCF9. Feel free to take a look at it. Depending on which VCF components you are using, you may need to take other steps beforehand.</div>
    </aside>
<h2 id="uprade-sddc">Uprade SDDC<a href="#uprade-sddc" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>In my setup, the first step is to upgrade the SDDC Manager. As I mentioned above, after the upgrade, the setup will be added to my VCF Operations, which is already up to date.</p>
<p>
<figure><a href="02.png"><picture>
          <source srcset="/vcf5-to-vcf9/02_hu_a69c7939fbfd71bc.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/02_hu_73ad07b82ebd1973.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/02_hu_a69c7939fbfd71bc.webp"alt="SDDC Manager"  width="1700"  height="874" />
        </picture></a><figcaption>
            <p>SDDC Manager upgrade (click to enlarge)</p>
          </figcaption></figure>
The process is relatively straightforward. The 2 GB of data must be downloaded from the network via the SDDC, after which the upgrade can be initiated.</p>

<figure><a href="03.png"><picture>
          <source srcset="/vcf5-to-vcf9/03_hu_59508595ecf2682f.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/03_hu_5d6236c96eb553df.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/03_hu_59508595ecf2682f.webp"alt="SDDC Manager status"  width="1720"  height="1259" />
        </picture></a><figcaption>
            <p>SDDC Manager upgrade status (click to enlarge)</p>
          </figcaption></figure>
<p>The SDDC is booted once during the upgrade. I had a minor problem with the SDDC in that it no longer displayed the upgrade status after rebooting.
Instead, I only saw update status 0. I checked the log file /var/log/vmware/capengine/cap-update/workflow.log via SSH on the SDDC manager and looked to see if the following was visible:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">YYYY-MM-DDTHH:MM:SS.426528 workflow_manager.go:221: Task stage-cleanup completed
</span></span><span class="line"><span class="cl">YYYY-MM-DDTHH:MM:SS.426646 workflow_manager.go:183: All tasks finished for workflow
</span></span><span class="line"><span class="cl">YYYY-MM-DDTHH:MM:SS.426699 workflow_manager.go:354: Updating instance status to Completed
</span></span></code></pre></div><p>After that, I rebooted the SDDC again and the error was fixed. I had never had this problem before and couldn&rsquo;t find any KB articles about it. Maybe my nested environment was too slow. So take this fix with a grain of salt.
Finally, I configured my VCF9 offline repo in the SDDC as a repository, as I don&rsquo;t want to download all the VCF9 binaries from the network.</p>
<h2 id="binary-management">Binary Management<a href="#binary-management" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>SDDC version 9 supports the Broadcom download token, so there is no need to change anything with a script on the SDDC, but I prefer my central offline repo.
I built my own repo with the help of <a href="https://github.com/tsugliani/doc-vcf-offlinedepot">Timo Sugliani&rsquo;s instructions</a>.
It is the easiest way to get your own offline repo, even if you have no Linux knowledge. However, you still need a valid download token.</p>

<figure><a href="04.png"><picture>
          <source srcset="/vcf5-to-vcf9/04_hu_56d1d44bd577aad9.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/04_hu_35e79126558034eb.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/04_hu_56d1d44bd577aad9.webp"alt="Binary Management"  width="1704"  height="807" />
        </picture></a><figcaption>
            <p>Binary Management (click to enlarge)</p>
          </figcaption></figure>
<p>Next, I download the upgrade binaries for NSX, vCenter, and ESX to my SDDC manager.
The download is faster than the validation. It took me about 30 minutes to get everything I needed.</p>
<h2 id="starting-the-upgrade">Starting the upgrade<a href="#starting-the-upgrade" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I start the upgrade with the SDDC for the management domain. To do this, go to Workload Domains —&gt; Management Domain —&gt; Updates in the SDDC manager and then click on the Plan Upgrades button.
The process is actually exactly the same as for a normal VCF update.</p>

<figure><a href="05.png"><picture>
          <source srcset="/vcf5-to-vcf9/05_hu_6b3f71366fb05a59.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/05_hu_e6f21e13449de908.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/05_hu_6b3f71366fb05a59.webp"alt="Paln Upgrade"  width="1721"  height="978" />
        </picture></a><figcaption>
            <p>Plan Upgrade (click to enlarge)</p>
          </figcaption></figure>
<p>I select VCF version 9.0.0.0 as the target version and confirm the version summary.</p>

<figure><a href="06.png"><picture>
          <source srcset="/vcf5-to-vcf9/06_hu_cf0c8d46e4bc7904.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/06_hu_1ee9600d63300db5.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/06_hu_cf0c8d46e4bc7904.webp"alt="Version summary"  width="1479"  height="685" />
        </picture></a><figcaption>
            <p>Version summary (click to enlarge)</p>
          </figcaption></figure>
<p>This completes the upgrade plan. It is important to note that the SDDC will only start the upgrade once we have clicked Configure Update.
The order of the components is as follows:</p>
<ul>
<li>NSX</li>
<li>vCenter</li>
<li>ESX hosts</li>
<li>vSAN</li>
</ul>
<p>You can only configure the update for one component at a time. Pre-checks must be performed before each update.
Here, too, the process is no different from a normal VCF update.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">Since I have a nested VCF setup with vSAN, there will be some errors. However, these can be ignored.</div>
    </aside>
<h3 id="nsx">NSX<a href="#nsx" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Since I don&rsquo;t have any edges deployed, the NSX upgrade runs without any problems.
If I had edge VMs in my environment, I would have had to intervene because of the Ryzen processors, otherwise the edge upgrade would have failed.
I explained why this is the case in my article on <a href="https://sdn-warrior.org/posts/ms-a2/#wheres-the-poop-robin">MS-A2</a>.</p>
<h3 id="vcenter">vCenter<a href="#vcenter" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Next up is the vCenter. Here, the vCenter <em><strong>Reduced Downtime Update</strong></em> is used. This means that a second vCenter appliance is deployed in parallel and assigned a temporary IP address.
There are two options here: either I assign a static temporary IP address or I use Auto.</p>
<p>I usually use IP addresses defined by my customers, as firewalls are usually involved in whatever form.
Since I am working here in my lab without a firewall within the lab, I can use auto.
This gives the old and new vCenter a temporary APIPA IP to communicate with each other.
For the upgrade scheduler, I use Immediate and Automatic for the switchover.</p>

<figure><a href="07.png"><picture>
          <source srcset="/vcf5-to-vcf9/07_hu_64901a29b83c6af2.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/07_hu_d6220f1001c84026.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/07_hu_64901a29b83c6af2.webp"alt="vCenter update"  width="1714"  height="948" />
        </picture></a><figcaption>
            <p>vCenter update (click to enlarge)</p>
          </figcaption></figure>
<h3 id="esx---houston-we-have-a-problem">ESX - Houston, we have a problem!<a href="#esx---houston-we-have-a-problem" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The update ran successfully, but I have the problem that my vCenter simply does not want to display ESX9 images, which is essential because without ESX9 images, you cannot upgrade the ESX servers to 9.
I thought I was being clever and forced the vCenter to search for new images. You can do this using the deprecated vCenter Lifecycle Manager and push <em><strong>Sync Updates</strong></em>.</p>

<figure><a href="08.png"><picture>
          <source srcset="/vcf5-to-vcf9/08_hu_d88b3bf8a837c129.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/08_hu_1d2df49c7ed27feb.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/08_hu_d88b3bf8a837c129.webp"alt="vCenter Lifecycle Manager"  width="1663"  height="1182" />
        </picture></a><figcaption>
            <p>vCenter Lifecycle Manager (click to enlarge)</p>
          </figcaption></figure>
<p>Interestingly, the process is not running correctly. I hadn&rsquo;t encountered this before, and after a quick check in the task log in vCenter, I saw the following error message, which wasn&rsquo;t really helpful.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">A general system error occurred: Down load patch definitions task failed while synci ng depots. 
</span></span><span class="line"><span class="cl">Error: &#39;integrity.fault.Vclntegrityf ault: VMware Sphere Lifecycle Manager hi d an unknown error. 
</span></span><span class="line"><span class="cl">Check the events and I og files for details.
</span></span></code></pre></div>
<figure><a href="09.png"><picture>
          <source srcset="/vcf5-to-vcf9/09_hu_97bbce537a4e9f79.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/09_hu_28f3f8d4f30bc5bc.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/09_hu_97bbce537a4e9f79.webp"alt="vCenter Tasks"  width="1406"  height="451" />
        </picture></a><figcaption>
            <p>vCenter Tasks (click to enlarge)</p>
          </figcaption></figure>
<p>Of course, there is nothing specific in the logs either. So Google research&hellip;Because the second most important skill in my IT career is knowing how to Google properly—maybe it&rsquo;s even my most important skill.</p>
<p>Turns out it&rsquo;s a known bug in vCenter 9 when performing a brownfield upgrade from 8 to 9.
VMware has created a <a href="https://knowledge.broadcom.com/external/article?articleNumber=402037">KB article</a> on this topic.
The solution is relatively simple: you need to delete metadata from the vCenter DB in the tables <em><strong>vci_updates</strong></em> and <em><strong>vci_update_packages</strong></em>.</p>
<h3 id="vcenter-workaround">vCenter workaround<a href="#vcenter-workaround" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<ul>
<li>Lgin to vCenter as Root</li>
<li>Stop updatemgr service</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">service-control --stop updatemgr
</span></span></code></pre></div><ul>
<li>Change to &lsquo;updatemgr&rsquo; user.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">su updatemgr -s /bin/bash
</span></span></code></pre></div><ul>
<li>Run psql command to patch the DB</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">psql -U vumuser -d VCDB -c &#34;UPDATE vci_updates set deleted = 0, hidden = 0 where meta_uid like &#39;ESXi7%&#39; or meta_uid like &#39;esxi7%&#39; or meta_uid like &#39;ESXi_7%&#39; or meta_uid like &#39;esxi_7%&#39;; DELETE FROM vci_updates where id not in (select update_id from vci_update_packages);&#34;
</span></span></code></pre></div><ul>
<li>Start updatemgr service</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">service-control --start updatemgr
</span></span></code></pre></div><p>After the changes and the restart of the service, vCenter automatically syncs the image data. Now a new image can be created.</p>

<figure><a href="10.png"><picture>
          <source srcset="/vcf5-to-vcf9/10_hu_79a84f07dd3e4e71.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/10_hu_aaca4ea888e17137.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/10_hu_79a84f07dd3e4e71.webp"alt="vCenter Images"  width="1356"  height="682" />
        </picture></a><figcaption>
            <p>vCenter Lifecycle Manager after workaround (click to enlarge)</p>
          </figcaption></figure>
<h3 id="esx-image">ESX Image<a href="#esx-image" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>For Image Mode, we still need to import an image into the SDDC; without this, the ESX servers cannot be upgraded to 9.
After fixing the vCenter, I create a dummy cluster in the vCenter and select the correct image for VCF9.</p>

    <aside class="admonition attention">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Attention</b>
        </div>
        <div class="admonition-content">It is important that the image from the BOM is used. For VCF9.0.0.0, this is ESX 9.0.0.0 Build 24755229.
There is now a patch for ESX 9 (9.0.0.0100), but this cannot be used for the upgrade to VCF9.
Instead, it must be installed via VCF 9 Operations after the upgrade to VCF9 has been successfully completed.</div>
    </aside>
<p>The image is then imported into the SDDC and the dummy cluster can be deleted again in vCenter.
The image is assigned to the management domain cluster in the “Configure Update” step, and after the pre-checks, the ESX servers can be updated.
The process ran smoothly - easy, that&rsquo;s what I expected from the start.</p>

    <aside class="admonition attention">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Attention</b>
        </div>
        <div class="admonition-content">Before each update, I check vSAN Skyline Health and silence any alarms that may be present due to nested virtualization and the resulting non-certified hardware.</div>
    </aside>
<h3 id="vsan">vSAN<a href="#vsan" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The final step in the actual upgrade process is to update the vSAN storage.
The process is straightforward, and all you need to do is press the upgrade button under cluster &ndash;&gt; configure &ndash;&gt; vSAN.
Depending on the hardware and size of the vSAN storage, this process can take a relatively long time.</p>

<figure><a href="11.png"><picture>
          <source srcset="/vcf5-to-vcf9/11_hu_7ad3817b973e1cf1.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/11_hu_8210b3d3183aa80e.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/11_hu_7ad3817b973e1cf1.webp"alt="vSAN"  width="1715"  height="672" />
        </picture></a><figcaption>
            <p>vSAN upgrade (click to enlarge)</p>
          </figcaption></figure>
<p>Now everything is ready for me to start onboarding in Operations.</p>
<h3 id="onboarding-in-vcf-operations">Onboarding in VCF Operations<a href="#onboarding-in-vcf-operations" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>I have a central VCF Operations because I don&rsquo;t want to deploy an entire fleet every time I need a new nested lab.
I described how I built it in this <a href="https://sdn-warrior.org/posts/vcf-operations-migration/">article</a>.
When onboarding in Operations, there are really only two things to keep in mind.
I have to configure the new VCF environment as a <em><strong>deployment target</strong></em>, and I have to enable <em><strong>activate management</strong></em>, otherwise I cannot distribute licenses for the environment with my VCF Operations instance.</p>
<p>To onboard, I need to add the VCF instance to my Ops via VCF Operations —&gt; Administration —&gt; Integrations —&gt; Accounts —&gt; Vmware Cloud Foundation.
Once the environment appears under Integrations, you can select it and press the Activate Management button. This allows you to assign a license to the VCF instance.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">It may take up to 15 minutes for the setting to become active and for VCF Operations to display the VCF instance in the licensing dialog.</div>
    </aside>
<p>Finally, the VCF instance is set up as an deployment target under —&gt; Lifecycle —&gt; VCF Management —&gt; Settings —&gt; Deployment Targets.</p>
<p>The upgrade is now complete and the VCF 9 instance can be used as normal.
Optionally, you can install the ESX patch under Lifecycle.
To do this, you must create a new image in vCenter and import it via Ops.
The process is more or less identical to the previous update.</p>

<figure><a href="12.png"><picture>
          <source srcset="/vcf5-to-vcf9/12_hu_1ffe814a16b4c26c.webp" type="image/webp">
          <source srcset="/vcf5-to-vcf9/12_hu_71a9bbdb012f71f6.jpg" type="image/jpeg">
          <img src="/vcf5-to-vcf9/12_hu_1ffe814a16b4c26c.webp"alt="VCF Operations"  width="1437"  height="1049" />
        </picture></a><figcaption>
            <p>VCF Operations (click to enlarge)</p>
          </figcaption></figure>
<h2 id="final-thoughts">Final thoughts<a href="#final-thoughts" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>The upgrade was more difficult than expected.
The missing images in particular took me longer than I would like to admit.
To be honest, I thought it would be a straightforward process.
My VCF 5.2.1 environment was completely new, with no previous updates or other legacy issues.</p>
<p>I think VCF 9.0.1 will remedy this, because in theory the upgrade process is very simple and doesn&rsquo;t really differ much from a normal patch update in VCF5.X.</p>
<p>What I still want to test is an import, i.e., converting a standalone NSX installation into a workload domain.
Unfortunately, the same applies here as with my old NSX Labs: when updating my physical lab, I destroyed most of my old setups (because I&rsquo;m sometimes just stupid).
Only labs that are unusable in this case have survived.</p>
<p>Well, I&rsquo;ll do another NSX 4.2.1 deployment at some point. But that will be another blog post.
If you have any questions or comments, please feel free to send me a message on LinkedIn or to my blog email address.</p>

			</div>
			
			<div class="post-divider">
  				<img src="/end.png" alt="End graphic" loading="lazy">
			</div>

<div class="related-posts thin">
	<h2>See Also</h2>
	<ul>
	
	<li><a href="/posts/vcf-token/">VCF - How to use the Broadcom Download Token</a></li>
	
	<li><a href="/posts/explore-2025/">VMware Explore 2025</a></li>
	
	<li><a href="/posts/vcf9-cert-exchange/">VCF 9 - Certificate exchange</a></li>
	
	<li><a href="/posts/vcf9-nsx-vpc-part3/">VCF 9 - NSX VPC Part 3 - Security</a></li>
	
	<li><a href="/posts/vcf-operations-migration/">VCF 9 - Migration to central VCF Operations instance</a></li>
	
	</ul>
</div>

		</article>
		<div class="post-nav thin">
			<a class="prev-post" href="https://sdn-warrior.org/posts/explore-2025/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right">
      <line x1="5" y1="12" x2="19" y2="12"></line>
      <polyline points="12 5 19 12 12 19"></polyline>
   </svg></span><br><span>VMware Explore 2025</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2025 <a href="https://sdn-warrior.org/">SDN-Warrior</a>
		&#183; COPYRIGHT Daniel Krieger
		&#183; <a href="https://sdn-warrior.org/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
   stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss">
   <path d="M4 11a9 9 0 0 1 9 9"></path>
   <path d="M4 4a16 16 0 0 1 16 16"></path>
   <circle cx="5" cy="19" r="1"></circle>
</svg></a></p>

<script defer src="/klaro/klaro-config.js"></script>

<script defer src="/klaro/klaro.js"></script>
</footer>
<script async src="https://sdn-warrior.org/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js" integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin="anonymous"></script><script async src="https://sdn-warrior.org/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js" integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin="anonymous"></script>
</body>

</html>
