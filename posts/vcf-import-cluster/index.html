

<!DOCTYPE html>
<html lang="en-us">
<head>
<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics">
  // Hier kommt dein GA-Code (Google Analytics 4 empfohlen!)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNTG7NNKQN', { 'anonymize_ip': true });
</script>

<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics" src="https://www.googletagmanager.com/gtag/js?id=G-YNTG7NNKQN"></script>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow"><link rel="author" href="/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="SDN-Warrior"><meta name="description" content="Importing from a vSphere cluster with NFS 3 as principal storage without losing support.">

  <meta itemprop="name" content="VCF Import Tool - Run VCF with NFS as principal Storage ">
  <meta itemprop="description" content="Importing from a vSphere cluster with NFS 3 as principal storage without losing support.">
  <meta itemprop="datePublished" content="2025-02-23T16:00:00+01:00">
  <meta itemprop="dateModified" content="2025-02-23T16:00:00+01:00">
  <meta itemprop="wordCount" content="2114">
  <meta itemprop="image" content="https://sdn-warrior.org/images/preview.png">
  <meta itemprop="keywords" content="Vmware,Vcf,Homelab,Broadcom,Nfs"><meta property="og:url" content="https://sdn-warrior.org/posts/vcf-import-cluster/">
  <meta property="og:site_name" content="SDN-Warrior | Daniel Krieger">
  <meta property="og:title" content="VCF Import Tool - Run VCF with NFS as principal Storage ">
  <meta property="og:description" content="Importing from a vSphere cluster with NFS 3 as principal storage without losing support.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-02-23T16:00:00+01:00">
    <meta property="article:modified_time" content="2025-02-23T16:00:00+01:00">
    <meta property="article:tag" content="Vmware">
    <meta property="article:tag" content="Vcf">
    <meta property="article:tag" content="Homelab">
    <meta property="article:tag" content="Broadcom">
    <meta property="article:tag" content="Nfs">
    <meta property="og:image" content="https://sdn-warrior.org/images/preview.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://sdn-warrior.org/images/preview.png">
  <meta name="twitter:title" content="VCF Import Tool - Run VCF with NFS as principal Storage ">
  <meta name="twitter:description" content="Importing from a vSphere cluster with NFS 3 as principal storage without losing support.">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "VCF Import Tool - Run VCF with NFS as principal Storage ",
    "name": "VCF Import Tool - Run VCF with NFS as principal Storage ",
    "description": "Importing from a vSphere cluster with NFS 3 as principal storage without losing support.",
    "keywords": ["vmware", "vcf", "homelab", "broadcom", "nfs"],
    "articleBody": "Introduction VCF is a powerful platform designed to simplify the deployment of vSphere, NSX and the Aria product family. This is both a blessing and a curse. On the one hand, the Cloudbuilder and SDDC Manager significantly simplify deployment, but this also takes away a certain amount of flexibility. In addition, not every customer starts on a greenfield site. Another point is the need for resources, which affects us home labbers in particular. Many want to prepare for the new VCP exams and are now forced to deploy VCF in their Homelab. There are already many solutions for this, such as the Holodeck, the Automated Lab Deployment Scrip) or the Automated VMware Cloud Foundation Import Lab Deployment script (both from the great William Lam), but in my view this is too far removed from the kind of deployment that a customer will experience. Therefore I will show several ways how to create VCF as close as possible to a real deployment without needing the real resources. In this article I would like to show you how to do a convert with the VCF Import Tool. I will write more articles about VCF deployment in the future.\nWhy use the import tool? As indicated in the title, the import tool allows a VCF deployment with NFS as principal storage, which means that we do not need vSAN. As much as I like vSAN, vSAN in Homelab always means additional resource consumption. I need fast networking, local NVMes and the overall performance is still not great as I usually set up my LABs nested in my homelab. In addition, the use of vSAN consumer NVMes wears out very quickly. Thanks to VCF 5.2 and the VCF Import Tool, we can get around this relatively easily. Of course, there are always a few limitations.\nStorage Type Consolidated Workload Domain Management Domain VI Workload Domain Principal Storage No Only for a management domain converted from vSphere infrastructure Yes Supplemental Storage Yes Yes Yes NFS Version\rOnly supports NFS protocol version 3 when used as principal storage. Supplemental storage can use either vSphere supported NFS protocol version 3 or 4.1. Although NFS 3 and NFS 4.1 can coexist on the same host, you cannot use different NFS versions to mount the same datastore on different hosts.\rWhat can we take from the table now? It is possible to deploy a standard VCF design with NFS3 and without vSAN, and the best part is that the whole thing is officially supported and is not a homemade solution.\nDeployment and preparation of the management domain First of all, we need to prepare our future management domain. To do this, I am deploying four virtual ESXi servers. I am using the Flings OVA from William Lam and adapting it for my lab. My 4 ESX Nested Servers have the following hardware:\n10 vCPUs 45 GB RAM 16 GB Thin Storage 2 Network Cards Virtual Hardware\rIt is possible to carry out the deployment with fewer resources, but I had to deal with timeouts during the deployment and, based on my experience, these are the best sizing with my LAB hardware.\rNTP service and DNS including reverse lookup must be available and working. In addition, all VLANs, gateways and, if necessary, firewall rules must be in place. To keep this article short, I wonâ€™t go into this part in detail. The required networks can be found in the VCF Guide.\nOf course, there are a few restrictions and things that we have to consider here as well.\nCluster - Storage:\nDefault cluster must be one of vSAN, NFS v3, VMFS-FC, or VMFS-FCoE (only supported with VCF 5.2.1 and later). NFS 4.1, VVOLs, and native iSCSI are not supported\nClusters cannot be stretched vSAN (and we will not be using vSAN either)\nVCF 5.2: All clusters (vSAN, NFS v3, FC) must be 4 nodes minimum.\nVCF 5.2.1.x When using NFS or FC and vLCM images, the default cluster must be 2 nodes minimum. When using NFS or FC and vLCM baselines, the default cluster must be 4 nodes minimum.\nCluster - Network:\nvCenter Server must not have an existing NSX instance registered\nLACP - VCF Import Tool 5.2.1.2 with SDDC Manager 5.2.1.1: Supported other Version are Not supported\nUse vSphere Distributed Switches only. Standard or Cisco virtual switches are not supported.\nVMkernel IP addresses must be statically assigned\nMultiple VMkernels for a single traffic type (vSAN , vMotion) are not supported\nVCF Import Tool 5.2.1.2 with SDDC Manager 5.2.1.1: ESXi hosts can have a different number of physical uplinks (minimum 2) assigned to a vSphere distributed switch. Each uplink must be a minimum of 10Gb.\nEalier versions: ESXi hosts must have the same number of physical uplinks (minimum 2) assigned to a vSphere distributed switch. Each uplink must be a minimum of 10Gb.\nvSphere distributed switch teaming policies must match VMware Cloud Foundation standards\nDedicated vMotion network must be configured\nCluster - Compute:\nClusters must not be VxRail managed\nClusters that use vSphere Configuration Profiles are not supported\nAll clusters must be running vSphere 8.0U3 or later\nDRS must be fully automated\nLimitations\rThere are more limitations, but these should be the most important ones. 10 Gb/s network is not necessary in a nested environment. The exact requirements can be found in the current VCF 5.2 Administration Guide.\rSo after I have prepared my future management domain, it should look similar to the screenshot below.\nESXi Cluster with NFS Storage (click to enlarge)\nConvert the cluster to a management domain After I have prepared my cluster, the real fun can begin. To do this, I first need to download the SDDC Manager, the VCF Import Tool and the appropriate NSX bundle. In my case, it was the following software versions:\nVCF-SDDC-Manager-Appliance-5.2.1.1-24397777.ova VMware Software Install Bundle - NSX_T_MANAGER 4.2.1.0 VCF Import Tool 5.2.1.2 The software can be found in the Broadcom support portal under Tools and Drivers in the corresponding VCF 5.2.1 category. First, I deploy the SDDC Manager appliance to my cluster. The SDDC Manager will later deploy our NSX managers. The SDDC Manager will deploy NSX to the same network and storage where it is located. Network and storage cannot be customized during the deployment of the NSX managers. After that, I create a JSON file for the future NSX cluster. Here is my example file:\n{ \"license_key\": \"XXXX-XXXX-XXXX-XXXX-XXXX\", \"form_factor\": \"medium\", \"admin_password\": \"xxx\", \"install_bundle_path\": \"/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip\", \"cluster_ip\": \"10.28.0.10\", \"cluster_fqdn\": \"vcf03-m01-nsx01.lab.home\", \"manager_specs\": [ { \"fqdn\": \"vcf03-m01-nsx01a.lab.home\", \"name\": \"vcf03-m01-nsx01a\", \"ip_address\": \"10.28.0.11\", \"gateway\": \"10.28.0.1\", \"subnet_mask\": \"255.255.255.0\" }, { \"fqdn\": \"vcf03-m01-nsx01b.lab.home\", \"name\": \"vcf03-m01-nsx01b\", \"ip_address\": \"10.28.0.14\", \"gateway\": \"10.28.0.1\", \"subnet_mask\": \"255.255.255.0\" }, { \"fqdn\": \"vcf03-m01-nsx01c.lab.home\", \"name\": \"vcf03-m01-nsx01c\", \"ip_address\": \"10.28.0.15\", \"gateway\": \"10.28.0.1\", \"subnet_mask\": \"255.255.255.0\" } ] } NSX Deployment\rThe importer tool would like to create a 3 node NSX cluster by default. By customizing the actual domainmanager properties, you can reduce this to a single node â€“ however, this is then no longer supported by Broadcom and should not be used in a production environment. It is not enough to just customize the JSON file.\nIn addition, I tried it first with the small form factor and my convert was not successful because not all services could be started successfully on the NSX cluster. I have experienced this several times in nested environments. Therefore, I always deploy my NSX manager to medium and after a successful deployment, I manually remove the RAM reservation and reduce the manager to 4 vCPUs and 20GB ram. In my environment, this is the best compromise between resource consumption and functionality and performance.\nTipp: Customizing the NSX cluster size First, I log in to my SDDC manager with the VCF user via ssh and switch to the root context. Then I add the application-prod.properties file with the following addition.\ncat \u003e\u003e /etc/vmware/vcf/domainmanager/application-prod.properties \u003c\u003c EOF nsxt.manager.cluster.size=1 EOF systemctl restart domainmanager.service watch 'systemctl status domainmanager.service' After restarting the domain manager services, the changes should take effect and it is possible to deploy an NSX single node cluster. In my current test I did not do this, but in the past I have often done single node nsx cluster vcf deployments in the lab.\nUpload Software and run precheck The next step is relatively simple: I use WinSCP to upload the import tool, the NSX upgrade bundle and the NSX deployment json to my SDDC Manager. The upgrade bundle is placed in the directory specified in the NSX spec. In my case, it is\n/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip and I upload the NSX spec and the import tool to\n/home/vcf Next, uncompress the import tool and youâ€™re ready to go.\ntar xvf vcf-brownfield-import-5.2.1.2-24494579.tar.gz To run the precheck, we change to the vcf-browndield-toolset directory and run the precheck with the following command.\npython3 vcf_brownfield.py check --vcenter '' --sso-user '' Should there be any errors in the precheck, the tool generates guardrails files in which you can read about the problem. In my case, the precheck went cleanly and I can now start the actual convert of my management domain.\nThe command is more or less the same, only a few parameters have to be changed.\npython3 vcf_brownfield.py convert --vcenter '' --sso-user '' --domain-name '' --nsx-deployment-spec-path '' Actions:\nAction Additional Information -h, --help Shows the VCF Import Tool help. -v, --version Displays the VCF Import Tool version. convert Converts existing vSphere infrastructure into the management domain in SDDC Manager. check Checks whether a vCenter is suitable to be imported into SDDC Manager as a workload domain. import Imports a vCenter as a VI workload domain into SDDC Manager. sync Syncs an imported VI workload domain or a VI workload domain deployed from SDDC Manager. See Manage Workload Domain Configuration Drift Between vCenter Server and SDDC Manager. deploy-nsx Deploys NSX Manager as a standalone operation. See Deploy NSX Manager for Workload Domains. precheck Runs prechecks on vCenter. Parameter:\nParameter Additional Information --vcenter Target vCenter Server for the current operation. --sso-user SSO administrator user for the target vCenter Server. --sso-password SSO administrator password for the target vCenter Server. Used for prevalidation only. --domain-name Workload domain name to be assigned to the target environment during convert/import. --nsx-deployment-spec-path Absolute path to the NSX deployment spec JSON file. Info\rThe tool took about 80 minutes to complete the process on my system. Of course, it always depends on the performance of the environment. You can view the progress at any time in the SDDC or in the vCenter. In between, there are queries, such as whether you have taken a snapshot at the SDDC manager. So itâ€™s not easy to run completely unattended. So grab a coffee and enjoy the show.\rAfter the convert has hopefully been successful, the whole thing should now look like on my screenshot.\nConvert successfully(click to enlarge)\nMGMT Domain with NFS Storage(click to enlarge)\nCongratulations, we now have a supported workload domain with NFS storage. Of course, we still have some fine-tuning to do. For example, no NSX Edges have been deployed yet and the ESX servers have been made transport nodes, but they do not yet have TEP addresses. This is work that we have to do manually in the NSX Manager. We also still need to install licenses in the SDDC manager and setup the software repository so that we can install updates directly via the SDDC if necessary.\nNSX Edge Cluster\rNSX is deployed on the convert without overlay configuration. After manually adjusting the overlay config in the NSX Manager, you have to perform a sync via the import tool, otherwise you cannot deploy edge clusters via the SDDC and cannot use AVNs, which in turn are needed for the Aria Suite.\rThere are now two options for the future workload domains: 1. import via the import tool (the process is analogous to the convert) or 2. normal deployment via the SDDC manager.\nConclusion Importing or converting existing ESXi clusters enables us to deploy VCF in a resource-efficient way in the lab and also offers the possibility for PoCs for customers who would like to test VCF but do not have vSAN Ready nodes. The import tool in VCF 5.2 extends the possibilities of VCF and gives us a bit more flexibility in deploying VCF. From my point of view, this is the right way to make VCF more widely accepted by customers. It also gives us the opportunity to become familiar with the product with fewer resources.\nA last word\rI wouldnâ€™t recommend importing or converting an existing workload productively just yet. The feature is still quite new and, although many errors are already caught in the prechecks, itâ€™s not yet perfect and bulletproof. For customer PoCs, I would always set up a fresh cluster and then import it so that you donâ€™t end up with any legacy issues.\r",
    "wordCount" : "2114",
    "inLanguage": "en",
    "image":"https://sdn-warrior.org/images/net.jpg","datePublished": "2025-02-23T16:00:00+01:00",
    "dateModified": "2025-02-23T16:00:00+01:00",
    "author":{
        "@type": "Person",
        "name": "SDN-Warrior",
        "url": "https://sdn-warrior.org/about/"
        },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sdn-warrior.org/posts/vcf-import-cluster/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "SDN-Warrior | Daniel Krieger",
      "description": "",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sdn-warrior.org/favicon.ico"
      }
    }
}
</script><title>VCF Import Tool - Run VCF with NFS as principal Storage </title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="https://sdn-warrior.org/css/style.min.7a7849ee51fe6293acf273a1cfa43cab814574165ea83fb31ecc091e48376633.css" integrity="sha256-enhJ7lH+YpOs8nOhz6Q8q4FFdBZeqD+zHswJHkg3ZjM=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/images/net.jpg');}</style></head>
<body id="page">
	<header id="site-header">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://sdn-warrior.org/">SDN-Warrior | Daniel Krieger</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="https://sdn-warrior.org/posts/">Posts</a><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a><a href="https://sdn-warrior.org/links/">Links</a><a href="https://sdn-warrior.org/about/">About Me</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
   </svg></button><span class="hdr-links hide-in-mobile"><a href="https://de.linkedin.com/in/daniel-krieger-6476591a9" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2">
      <circle cx="18" cy="5" r="3"></circle>
      <circle cx="6" cy="12" r="3"></circle>
      <circle cx="18" cy="19" r="3"></circle>
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
   </svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf-import-cluster%2f&amp;text=VCF%20Import%20Tool%20-%20Run%20VCF%20with%20NFS%20as%20principal%20Storage%20" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6" />
</svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf-import-cluster%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg></a>
        </li>
        <li>
            <a href="mailto:?subject=VCF%20Import%20Tool%20-%20Run%20VCF%20with%20NFS%20as%20principal%20Storage%20&amp;body=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf-import-cluster%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
   <polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf-import-cluster%2f&amp;source=https%3a%2f%2fsdn-warrior.org%2f&amp;title=VCF%20Import%20Tool%20-%20Run%20VCF%20with%20NFS%20as%20principal%20Storage%20&amp;summary=VCF%20Import%20Tool%20-%20Run%20VCF%20with%20NFS%20as%20principal%20Storage%20%2c%20by%20SDN-Warrior%0a%0aImporting%20from%20a%20vSphere%20cluster%20with%20NFS%203%20as%20principal%20storage%20without%20losing%20support.%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;VCF Import Tool - Run VCF with NFS as principal Storage &#34;,&#34;https://sdn-warrior.org/posts/vcf-import-cluster/&#34;,&#34;VCF Import Tool - Run VCF with NFS as principal Storage , by SDN-Warrior\n\nImporting from a vSphere cluster with NFS 3 as principal storage without losing support.\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
   </svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
   </svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://sdn-warrior.org/posts/">Posts</a></li>
			<li><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a></li>
			<li><a href="https://sdn-warrior.org/links/">Links</a></li>
			<li><a href="https://sdn-warrior.org/about/">About Me</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Feb 23, 2025</span></div>
				<h1>VCF Import Tool - Run VCF with NFS as principal Storage </h1>
			</header>
			<div class="post-info"><p>Importing from a vSphere cluster with NFS 3 as principal storage without losing support.</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
   stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather">
   <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
   <line x1="16" y1="8" x2="2" y2="22"></line>
   <line x1="17.5" y1="15" x2="9" y2="15"></line>
</svg><a href="/about/" target="_blank">SDN-Warrior</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
      <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
      <line x1="7" y1="7" x2="7" y2="7"></line>
   </svg><span class="tag"><a href="https://sdn-warrior.org/tags/vmware">vmware</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/vcf">vcf</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/homelab">homelab</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/broadcom">broadcom</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/nfs">nfs</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
   </svg>2114 Words
     // ReadTime
    
    
    
    9 Minutes, 36 Seconds</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
   </svg>2025-02-23 16:00 &#43;0100</p></div>
			<hr class="post-end">
			<div class="content">
				<h2 id="introduction">Introduction<a href="#introduction" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>VCF is a powerful platform designed to simplify the deployment of vSphere, NSX and the Aria product family.
This is both a blessing and a curse. On the one hand, the Cloudbuilder and SDDC Manager significantly simplify deployment, but this also takes away a certain amount of flexibility.
In addition, not every customer starts on a greenfield site.
Another point is the need for resources, which affects us home labbers in particular.
Many want to prepare for the new VCP exams and are now forced to deploy VCF in their Homelab.
There are already many solutions for this, such as the Holodeck, the <a href="https://github.com/lamw/vcf-automated-lab-deployment">Automated Lab Deployment Scrip</a>) or the <a href="https://github.com/lamw/vcf-automated-import-lab-deployment">Automated VMware Cloud Foundation Import Lab Deployment</a> script (both from the great <a href="https://williamlam.com/">William Lam</a>), but in my view this is too far removed from the kind of deployment that a customer will experience.
Therefore I will show several ways how to create VCF as close as possible to a real deployment without needing the real resources.
In this article I would like to show you how to do a convert with the VCF Import Tool. I will write more articles about VCF deployment in the future.</p>
<h2 id="why-use-the-import-tool">Why use the import tool?<a href="#why-use-the-import-tool" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>As indicated in the title, the import tool allows a VCF deployment with NFS as principal storage, which means that we do not need vSAN.
As much as I like vSAN, vSAN in Homelab always means additional resource consumption.
I need fast networking, local NVMes and the overall performance is still not great as I usually set up my LABs nested in my homelab.
In addition, the use of vSAN consumer NVMes wears out very quickly.
Thanks to VCF 5.2 and the VCF Import Tool, we can get around this relatively easily. Of course, there are always a few limitations.</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Storage Type</th>
          <th style="text-align: center">Consolidated Workload Domain</th>
          <th style="text-align: center">Management Domain</th>
          <th style="text-align: center">VI Workload Domain</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><strong>Principal</strong> Storage</td>
          <td style="text-align: center">No</td>
          <td style="text-align: center">Only for a management domain converted from vSphere infrastructure</td>
          <td style="text-align: center">Yes</td>
      </tr>
      <tr>
          <td style="text-align: center"><strong>Supplemental</strong> Storage</td>
          <td style="text-align: center">Yes</td>
          <td style="text-align: center">Yes</td>
          <td style="text-align: center">Yes</td>
      </tr>
  </tbody>
</table>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>NFS Version</b>
        </div>
        <div class="admonition-content">Only supports NFS protocol version 3 when used as principal storage. Supplemental storage can use either vSphere supported NFS protocol version 3 or 4.1. Although NFS 3 and NFS 4.1 can coexist on the same host, you cannot use different NFS versions to mount the same datastore on different hosts.</div>
    </aside>
<p>What can we take from the table now? It is possible to deploy a standard VCF design with NFS3 and without vSAN, and the best part is that the whole thing is officially supported and is not a homemade solution.</p>
<h2 id="deployment-and-preparation-of-the-management-domain">Deployment and preparation of the management domain<a href="#deployment-and-preparation-of-the-management-domain" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>First of all, we need to prepare our future management domain. To do this, I am deploying four virtual ESXi servers. I am using the Flings OVA from William Lam and adapting it for my lab.
My 4 ESX Nested Servers have the following hardware:</p>
<ul>
<li>10 vCPUs</li>
<li>45 GB RAM</li>
<li>16 GB Thin Storage</li>
<li>2 Network Cards</li>
</ul>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Virtual Hardware</b>
        </div>
        <div class="admonition-content">It is possible to carry out the deployment with fewer resources, but I had to deal with timeouts during the deployment and, based on my experience, these are the best sizing with my LAB hardware.</div>
    </aside>
<p>NTP service and DNS including reverse lookup must be available and working. In addition, all VLANs, gateways and, if necessary, firewall rules must be in place. To keep this article short, I won&rsquo;t go into this part in detail. The required networks can be found in the VCF Guide.</p>
<p>Of course, there are a few restrictions and things that we have to consider here as well.</p>
<ul>
<li>
<p>Cluster - Storage:</p>
<p>Default cluster must be one of vSAN, NFS v3, VMFS-FC, or VMFS-FCoE (only supported with VCF 5.2.1 and later).
NFS 4.1, VVOLs, and native iSCSI are not supported</p>
<p>Clusters cannot be stretched vSAN (and we will not be using vSAN either)</p>
<p>VCF 5.2: All clusters (vSAN, NFS v3, FC) must be 4 nodes minimum.</p>
<p>VCF 5.2.1.x When using NFS or FC and vLCM images, the default cluster must be 2 nodes minimum. When using NFS or FC and vLCM baselines, the default cluster must be 4 nodes minimum.</p>
</li>
<li>
<p>Cluster - Network:</p>
<p>vCenter Server must not have an existing NSX instance registered</p>
<p>LACP - VCF Import Tool 5.2.1.2 with SDDC Manager 5.2.1.1: Supported other Version are Not supported</p>
<p>Use vSphere Distributed Switches only. Standard or Cisco virtual switches are not supported.</p>
<p>VMkernel IP addresses must be statically assigned</p>
<p>Multiple VMkernels for a single traffic type (vSAN , vMotion) are not supported</p>
<p>VCF Import Tool 5.2.1.2 with SDDC Manager 5.2.1.1: ESXi hosts can have a different number of physical uplinks (minimum 2) assigned to a vSphere distributed switch. Each uplink must be a minimum of 10Gb.</p>
<p>Ealier versions: ESXi hosts must have the same number of physical uplinks (minimum 2) assigned to a vSphere distributed switch. Each uplink must be a minimum of 10Gb.</p>
<p>vSphere distributed switch teaming policies must match VMware Cloud Foundation standards</p>
<p>Dedicated vMotion network must be configured</p>
</li>
<li>
<p>Cluster - Compute:</p>
<p>Clusters must not be VxRail managed</p>
<p>Clusters that use vSphere Configuration Profiles are not supported</p>
<p>All clusters must be running vSphere 8.0U3 or later</p>
<p>DRS must be fully automated</p>
</li>
</ul>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Limitations</b>
        </div>
        <div class="admonition-content">There are more limitations, but these should be the most important ones.
10 Gb/s network is not necessary in a nested environment. The exact requirements can be found in the current <a href="https://techdocs.broadcom.com/us/en/vmware-cis/vcf/vcf-5-2-and-earlier/5-2/map-for-administering-vcf-5-2/importing-existing-vsphere-environments-admin/considerations-before-converting-or-importing-existing-vsphere-environments-into-vcf-admin.html">VCF 5.2 Administration Guide</a>.</div>
    </aside>
<p>So after I have prepared my future management domain, it should look similar to the screenshot below.</p>

<figure><a href="vcf01.png"><picture>
          <source srcset="/vcf-import/vcf01_hu_c95dd8930db031a9.webp" type="image/webp">
          <source srcset="/vcf-import/vcf01_hu_63424ee8bc073bac.jpg" type="image/jpeg">
          <img src="/vcf-import/vcf01_hu_c95dd8930db031a9.webp"alt="ESXi Cluster"  width="1257"  height="550" />
        </picture></a><figcaption>
            <p>ESXi Cluster with NFS Storage (click to enlarge)</p>
          </figcaption></figure>
<h2 id="convert-the-cluster-to-a-management-domain">Convert the cluster to a management domain<a href="#convert-the-cluster-to-a-management-domain" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>After I have prepared my cluster, the real fun can begin. To do this, I first need to download the SDDC Manager, the VCF Import Tool and the appropriate NSX bundle.
In my case, it was the following software versions:</p>
<ul>
<li>VCF-SDDC-Manager-Appliance-5.2.1.1-24397777.ova</li>
<li>VMware Software Install Bundle - NSX_T_MANAGER 4.2.1.0</li>
<li>VCF Import Tool 5.2.1.2</li>
</ul>
<p>The software can be found in the Broadcom support portal under Tools and Drivers in the corresponding VCF 5.2.1 category.
First, I deploy the SDDC Manager appliance to my cluster. The SDDC Manager will later deploy our NSX managers. The SDDC Manager will deploy NSX to the same network and storage where it is located. Network and storage cannot be customized during the deployment of the NSX managers.
After that, I create a JSON file for the future NSX cluster. Here is my example file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license_key&#34;</span><span class="p">:</span> <span class="s2">&#34;XXXX-XXXX-XXXX-XXXX-XXXX&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;form_factor&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;admin_password&#34;</span><span class="p">:</span> <span class="s2">&#34;xxx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;install_bundle_path&#34;</span><span class="p">:</span> <span class="s2">&#34;/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cluster_ip&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.10&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;cluster_fqdn&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01.lab.home&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;manager_specs&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fqdn&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01a.lab.home&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01a&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ip_address&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.11&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;gateway&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;subnet_mask&#34;</span><span class="p">:</span> <span class="s2">&#34;255.255.255.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fqdn&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01b.lab.home&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01b&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ip_address&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.14&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;gateway&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;subnet_mask&#34;</span><span class="p">:</span> <span class="s2">&#34;255.255.255.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;fqdn&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01c.lab.home&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;vcf03-m01-nsx01c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ip_address&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.15&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;gateway&#34;</span><span class="p">:</span> <span class="s2">&#34;10.28.0.1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;subnet_mask&#34;</span><span class="p">:</span> <span class="s2">&#34;255.255.255.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>
    <aside class="admonition attention">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>NSX Deployment</b>
        </div>
        <div class="admonition-content"><p>The importer tool would like to create a 3 node NSX cluster by default.
By customizing the actual domainmanager properties, you can reduce this to a single node â€“ however, this is then no longer supported by Broadcom and should not be used in a production environment.
It is not enough to just customize the JSON file.</p>
<p>In addition, I tried it first with the small form factor and my convert was not successful because not all services could be started successfully on the NSX cluster. I have experienced this several times in nested environments. Therefore, I always deploy my NSX manager to medium and after a successful deployment, I manually remove the RAM reservation and reduce the manager to 4 vCPUs and 20GB ram. In my environment, this is the best compromise between resource consumption and functionality and performance.</p>
</div>
    </aside>
<h3 id="tipp-customizing-the-nsx-cluster-size">Tipp: Customizing the NSX cluster size<a href="#tipp-customizing-the-nsx-cluster-size" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>First, I log in to my SDDC manager with the VCF user via ssh and switch to the root context. Then I add the
application-prod.properties file with the following addition.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat &gt;&gt; /etc/vmware/vcf/domainmanager/application-prod.properties &lt;&lt; EOF
</span></span><span class="line"><span class="cl">nsxt.manager.cluster.size=1 
</span></span><span class="line"><span class="cl">EOF
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl restart domainmanager.service
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">watch &#39;systemctl status domainmanager.service&#39;
</span></span></code></pre></div><p>After restarting the domain manager services, the changes should take effect and it is possible to deploy an NSX single node cluster. In my current test I did not do this, but in the past I have often done single node nsx cluster vcf deployments in the lab.</p>
<h3 id="upload-software-and-run-precheck">Upload Software and run precheck<a href="#upload-software-and-run-precheck" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The next step is relatively simple: I use WinSCP to upload the import tool, the NSX upgrade bundle and the  NSX deployment json to my SDDC Manager.
The upgrade bundle is placed in the directory specified in the NSX spec. In my case, it is</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">/nfs/vmware/vcf/nfs-mount/bundle/bundle-133764.zip
</span></span></code></pre></div><p>and I upload the NSX spec and the import tool to</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">/home/vcf
</span></span></code></pre></div><p>Next, uncompress the import tool and you&rsquo;re ready to go.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">tar xvf vcf-brownfield-import-5.2.1.2-24494579.tar.gz
</span></span></code></pre></div><p>To run the precheck, we change to the vcf-browndield-toolset directory and run the precheck with the following command.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">python3 vcf_brownfield.py check --vcenter &#39;&lt;my-vcenter-address&gt;&#39; --sso-user &#39;&lt;my-sso-username&gt;&#39;
</span></span></code></pre></div><p>Should there be any errors in the precheck, the tool generates guardrails files in which you can read about the problem. In my case, the precheck went cleanly and I can now start the actual convert of my management domain.</p>
<p>The command is more or less the same, only a few parameters have to be changed.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">python3 vcf_brownfield.py convert --vcenter &#39;&lt;vcenter-fqdn&gt;&#39; --sso-user &#39;&lt;sso-user&gt;&#39; --domain-name &#39;&lt;wld-domain-name&gt;&#39; --nsx-deployment-spec-path &#39;&lt;nsx-deployment-json-spec-path&gt;&#39;
</span></span></code></pre></div><p>Actions:</p>
<table>
  <thead>
      <tr>
          <th>Action</th>
          <th>Additional Information</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>-h, --help</code></td>
          <td>Shows the VCF Import Tool help.</td>
      </tr>
      <tr>
          <td><code>-v, --version</code></td>
          <td>Displays the VCF Import Tool version.</td>
      </tr>
      <tr>
          <td><code>convert</code></td>
          <td>Converts existing vSphere infrastructure into the management domain in SDDC Manager.</td>
      </tr>
      <tr>
          <td><code>check</code></td>
          <td>Checks whether a vCenter is suitable to be imported into SDDC Manager as a workload domain.</td>
      </tr>
      <tr>
          <td><code>import</code></td>
          <td>Imports a vCenter as a VI workload domain into SDDC Manager.</td>
      </tr>
      <tr>
          <td><code>sync</code></td>
          <td>Syncs an imported VI workload domain or a VI workload domain deployed from SDDC Manager. See <em>Manage Workload Domain Configuration Drift Between vCenter Server and SDDC Manager</em>.</td>
      </tr>
      <tr>
          <td><code>deploy-nsx</code></td>
          <td>Deploys NSX Manager as a standalone operation. See <em>Deploy NSX Manager for Workload Domains</em>.</td>
      </tr>
      <tr>
          <td><code>precheck</code></td>
          <td>Runs prechecks on vCenter.</td>
      </tr>
  </tbody>
</table>
<p>Parameter:</p>
<table>
  <thead>
      <tr>
          <th>Parameter</th>
          <th>Additional Information</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>--vcenter</code></td>
          <td>Target vCenter Server for the current operation.</td>
      </tr>
      <tr>
          <td><code>--sso-user</code></td>
          <td>SSO administrator user for the target vCenter Server.</td>
      </tr>
      <tr>
          <td><code>--sso-password</code></td>
          <td>SSO administrator password for the target vCenter Server. Used for prevalidation only.</td>
      </tr>
      <tr>
          <td><code>--domain-name</code></td>
          <td>Workload domain name to be assigned to the target environment during convert/import.</td>
      </tr>
      <tr>
          <td><code>--nsx-deployment-spec-path</code></td>
          <td>Absolute path to the NSX deployment spec JSON file.</td>
      </tr>
  </tbody>
</table>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">The tool took about 80 minutes to complete the process on my system. Of course, it always depends on the performance of the environment.
You can view the progress at any time in the SDDC or in the vCenter. In between, there are queries, such as whether you have taken a snapshot at the SDDC manager. So it&rsquo;s not easy to run completely unattended. So grab a coffee and enjoy the show.</div>
    </aside>
<p>After the convert has hopefully been successful, the whole thing should now look like on my screenshot.</p>

<figure><a href="vcf02.png"><picture>
          <source srcset="/vcf-import/vcf02_hu_ff8c78de8946466a.webp" type="image/webp">
          <source srcset="/vcf-import/vcf02_hu_984d7722d590294a.jpg" type="image/jpeg">
          <img src="/vcf-import/vcf02_hu_ff8c78de8946466a.webp"alt="Convert successfully"  width="2188"  height="773" />
        </picture></a><figcaption>
            <p>Convert successfully(click to enlarge)</p>
          </figcaption></figure>

<figure><a href="vcf03.png"><picture>
          <source srcset="/vcf-import/vcf03_hu_cc37f997f9abfa79.webp" type="image/webp">
          <source srcset="/vcf-import/vcf03_hu_11edb348f99072ba.jpg" type="image/jpeg">
          <img src="/vcf-import/vcf03_hu_cc37f997f9abfa79.webp"alt="MGMT Domain with NFS Storage"  width="1489"  height="534" />
        </picture></a><figcaption>
            <p>MGMT Domain with NFS Storage(click to enlarge)</p>
          </figcaption></figure>
<p>Congratulations, we now have a supported workload domain with NFS storage.
Of course, we still have some fine-tuning to do. For example, no NSX Edges have been deployed yet and the ESX servers have been made transport nodes, but they do not yet have TEP addresses.
This is work that we have to do manually in the NSX Manager.
We also still need to install licenses in the SDDC manager and setup the software repository so that we can install updates directly via the SDDC if necessary.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>NSX Edge Cluster</b>
        </div>
        <div class="admonition-content">NSX is deployed on the convert without overlay configuration. After manually adjusting the overlay config in the NSX Manager, you have to perform a sync via the import tool, otherwise you cannot deploy edge clusters via the SDDC and cannot use AVNs, which in turn are needed for the Aria Suite.</div>
    </aside>
<p>There are now two options for the future workload domains: 1. import via the import tool (the process is analogous to the convert) or 2. normal deployment via the SDDC manager.</p>
<h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Importing or converting existing ESXi clusters enables us to deploy VCF in a resource-efficient way in the lab and also offers the possibility for PoCs for customers who would like to test VCF but do not have vSAN Ready nodes. The import tool in VCF 5.2 extends the possibilities of VCF and gives us a bit more flexibility in deploying VCF. From my point of view, this is the right way to make VCF more widely accepted by customers. It also gives us the opportunity to become familiar with the product with fewer resources.</p>

    <aside class="admonition warning">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-alert-circle">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
   </svg></div><b>A last word</b>
        </div>
        <div class="admonition-content">I wouldn&rsquo;t recommend importing or converting an existing workload productively just yet. The feature is still quite new and, although many errors are already caught in the prechecks, it&rsquo;s not yet perfect and bulletproof. For customer PoCs, I would always set up a fresh cluster and then import it so that you don&rsquo;t end up with any legacy issues.</div>
    </aside>

			</div>
			
			<div class="post-divider">
  				<img src="/end.png" alt="End graphic" loading="lazy">
			</div>

<div class="related-posts thin">
	<h2>See Also</h2>
	<ul>
	
	<li><a href="/posts/homelab-v5/">Homelab V5</a></li>
	
	<li><a href="/posts/mac-learning/">MAC Learning is your friend</a></li>
	
	<li><a href="/posts/migration-with-hcx/">Migration with HCX</a></li>
	
	<li><a href="/posts/first-steps-ansible/">From Zero to Automation: How I Used ChatGPT to Create My First Ansible Playbook</a></li>
	
	<li><a href="/posts/iscsi-tuning/">iSCSI Tuning</a></li>
	
	</ul>
</div>

		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://sdn-warrior.org/posts/vcf-import-overlay/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
   </svg>&nbsp;Newer</span><br><span>VCF Import Tool - Enable Overlay in an imported VCF Domain</span>
			</a>
			<a class="prev-post" href="https://sdn-warrior.org/posts/jetkvm/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right">
      <line x1="5" y1="12" x2="19" y2="12"></line>
      <polyline points="12 5 19 12 12 19"></polyline>
   </svg></span><br><span>JetKVM - all show and no substance?</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2025 <a href="https://sdn-warrior.org/">SDN-Warrior</a>
		&#183; COPYRIGHT Daniel Krieger</p>

<script defer src="/klaro/klaro-config.js"></script>

<script defer src="/klaro/klaro.js"></script>
</footer>
<script async src="https://sdn-warrior.org/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js" integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin="anonymous"></script><script async src="https://sdn-warrior.org/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js" integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin="anonymous"></script>
</body>

</html>
