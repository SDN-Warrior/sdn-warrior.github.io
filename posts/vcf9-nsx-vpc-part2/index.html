

<!DOCTYPE html>
<html lang="en-us">
<head>
<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics">
  // Hier kommt dein GA-Code (Google Analytics 4 empfohlen!)
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YNTG7NNKQN', { 'anonymize_ip': true });
</script>

<script type="text/plain" data-type="application/javascript" data-name="googleAnalytics" src="https://www.googletagmanager.com/gtag/js?id=G-YNTG7NNKQN"></script>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow"><link rel="author" href="/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="icon" href="/favicon.svg" type="image/svg+xml"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="SDN-Warrior"><meta name="description" content="A short article about VPCs in NSX 9 and VCF 9 Part 2.">

  <meta itemprop="name" content="VCF 9 - NSX VPC Part 2 - distributed Transit Gateway">
  <meta itemprop="description" content="A short article about VPCs in NSX 9 and VCF 9 Part 2.">
  <meta itemprop="datePublished" content="2025-06-26T19:00:00+02:00">
  <meta itemprop="dateModified" content="2025-06-26T19:00:00+02:00">
  <meta itemprop="wordCount" content="2711">
  <meta itemprop="image" content="https://sdn-warrior.org/images/logo.jpg">
  <meta itemprop="keywords" content="Vcf,Nsx,Homelab,Vpc"><meta property="og:url" content="https://sdn-warrior.org/posts/vcf9-nsx-vpc-part2/">
  <meta property="og:site_name" content="SDN-Warrior | Daniel Krieger">
  <meta property="og:title" content="VCF 9 - NSX VPC Part 2 - distributed Transit Gateway">
  <meta property="og:description" content="A short article about VPCs in NSX 9 and VCF 9 Part 2.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-26T19:00:00+02:00">
    <meta property="article:modified_time" content="2025-06-26T19:00:00+02:00">
    <meta property="article:tag" content="Vcf">
    <meta property="article:tag" content="Nsx">
    <meta property="article:tag" content="Homelab">
    <meta property="article:tag" content="Vpc">
    <meta property="og:image" content="https://sdn-warrior.org/images/logo.jpg">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://sdn-warrior.org/images/logo.jpg">
  <meta name="twitter:title" content="VCF 9 - NSX VPC Part 2 - distributed Transit Gateway">
  <meta name="twitter:description" content="A short article about VPCs in NSX 9 and VCF 9 Part 2.">

<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "VCF 9 - NSX VPC Part 2 - distributed Transit Gateway",
    "name": "VCF 9 - NSX VPC Part 2 - distributed Transit Gateway",
    "description": "A short article about VPCs in NSX 9 and VCF 9 Part 2.",
    "keywords": ["vcf", "nsx", "homelab", "vpc"],
    "articleBody": "Introduction This is the second article in a series of articles (number of articles unknown) about VPCs in VCF 9. If you are not familiar with VPCs and have not yet come across this topic, I recommend reading Part 1 first. I will not go into all the basics again in this article, as these were already explained in the first article. In this article, I will look at the distributed deployment of VPCs and show how VPCs can also be used without an edge cluster.\nWait, did he really just write VPCs without Edge Clusters?! Sounds good, right?\nLet’s go - NSX project First things first. Since I am using the same VCF 9 installation as in my first article and we already have VPCs in centralized deployment here, I first create a new NSX project. Perhaps I should mention NSX Projects again here. VMware writes in the VCF 9 Guide: A project in NSX is analogous to a tenant. By creating projects, you can isolate security and networking objects across tenants in a single NSX deployment.\nI think that description fits quite well. In addition, we can currently only have one transit gateway per project. Since our default tenant (aka default project) has a transit gateway in centralized deployment, I need a new tenant aka project.\nInfo\rA small addition: whenever I refer to “tenant” in this article, I actually mean NSX project, but I find the name NSX project a bit cumbersome.\rTo create a new tenant, click on the Project drop-down menu in the NSX GUI and then click on Manage.\nNSX 9 project Manhatten (click to enlarge)\nThe most important setting besides the name (yes, I recently watched Oppenheimer) is the External Connection. These settings determine whether the transit gateway is distributed or centralized. The External IP Block defines the public VPC network (I explained the different networks in VPCs in Part 1). We have the option of connecting the project to a T0 gateway independently of the transit gateway. However, this is only relevant for non-VPC networks and will not be considered here. The same applies to the option of assigning an edge cluster to the tenant. Since I really want to avoid edges entirely in this article, we will also ignore this option. We also have the option of setting distributed firewall rules directly, which only allows communication within the tenant, but since firewalling will be covered in another article, we will ignore this option and disable it.\nInfo\rIn the NSX project create dialog, you can create a new external connection and external IP blocks using the three-dot menu.\rWe save our Manhattan project and now we have a fresh new tenant.\nExternal Connection - the distributed version We should take another closer look at the topic of external connections.\nNSX 9 project Manhatten external connection (click to enlarge)\nSince we have a distributed connection here, we need a VLAN and a gateway in my physical network. In my lab, it is VLAN 1011 and my Mikrotik Core Router has 10.28.11.1/24. My external IP block also comes from the network area of VLAN 1011, as my physical router has to route to this network.\nInfo\rNSX 9 currently only supports static routing, and if I had used a different external IP block, I would have had to set up additional routes on my Mikrotik – laziness wins out in this case.\rLet’s build a VPC, or two, or… Readers of Part 1 should now be quite familiar with all of this.\nget started with VPC (click to enlarge)\nFirst, we set up our private transit gateway IP block in the VPC Connectivity Profile or create one. Remember, this is an unrouted network, but it must not overlap with the other private VPC networks for all tenants. This network is used to connect VPCs to each other and is an NSX overlay network. Next, I configure the service profile, which is where I can configure a DHCP service for my VPC, and finally I create the private PVC IP CIDRs. As in my other article, this will again be 192.168.5.0/24.\nInfo\rThe private VPC IP CIDRs may overlap with other private VPC networks, as they are not routed between VPCs.\rThat’s it, our VPC has been created and we can now create our first VPC subnets. I will create a public, a private, and a transit network, each with 16 IPs and DHCP enabled. In addition, I will create the VPC Core in the same way. I hope the Demon Core doesn’t get too close - nudge nudge wink wink.\nThe tenants’ VPC networks are displayed in vCenter, but they are managed by NSX. This means that they cannot be extended or created via vCenter as in our default project.\nTest architecture I created six test VMs and assigned one VM to each VPC network. For a quick overview, here is a table showing all VMs.\nVM Name Network Type Gateway IP Address alpine01-demon-private private 192.168.5.1/28 192.168.5.3 alpine02-demon-transit transit 10.28.22.1/28 10.28.22.3 alpine03-demon-public public 10.28.11.17/28 10.28.11.19 alpine04-core-private private 192.168.5.1/28 192.168.5.3 alpine05-core-transit transit 10.28.22.17/28 10.28.22.19 alpine06-core-public public 10.28.11.33/28 10.28.11.35 The final VPC structure of the Manhattan tenant looks like this:\nVPCs tenant Manhatten (click to enlarge)\nWe can also test the interconnectivity between the VPCs from Part 1. The overall network topology looks like this:\nVPCs of all tenants (click to enlarge)\nHere are the test VMs from the first article:\nVM Name Network Type Gateway IP Adress alpine01-blue-private private 192.168.5.1/28 192.168.5.3 alpine02-blue-transit transit 10.28.12.1/28 10.28.12.3 alpine03-blue-public public 192.168.72.17/28 192.168.72.19 alpine04-red-private private 192.168.5.1/28 192.168.5.4 alpine05-red-transit transit 10.28.12.17/28 10.28.12.19 alpine06-red-public public 192.168.72.33/28 192.168.72.35 Test scenarios I will perform certain tests for each VM from VPC-Demon. First, I will test Internet connectivity, then intra-VPC connectivity, i.e., communication with all VMs in VPC-Demon, and finally inter-VPC connectivity, i.e., communication with all VMs in VPC-Core. Finally, I will perform a connectivity test from outside the NSX environment and a connection test to the VMs from VPC-BLUE. I will do all of this with simple ICMP tests. To do this, all firewalls on NSX and the VMs have been disabled. That’s a lot of tests, so let’s get started.\nalpine01-demon-private I will describe the tests using examples. For the other VMSs, I will present the results in a table.\nInternet connectivity In my first test, I want to see where alpine01-demon-private can communicate. The VM was assigned the IP address 192.168.5.3 by DHCP. Since our transit gateway was created in distributed mode, we cannot use auto SNAT and generally have no way of using stateful services. This means that the VM cannot communicate with the internet because the VPC private network is not routed and no SNAT is performed in the public network.\nIntra VPC connectivity Next, I test the connectivity to the alpine02-demon-transit vm. This test is also successful, as the transit VM can also be accessed via the VPC gateway. I also reach alpine03-demon-public vm. This happens fully distributed. Cool.\nInter VPC connectivity This is where it gets exciting. Basically, I can only access VMs from the same VPC here. If I had stateful SNAT, I could also access the public VMs of other VPCs belonging to other tenants or VMs of other VPCs in the transit network of my own tenant (provided the firewall allows this). Since we do not have NAT, a VM from a private VPC network cannot establish an intra-VPC connection.\nExternal connectivity The VM cannot be accessed externally. My core router also does not have a route for the 192.168.5.0/28 subnet. Even if my router has a route for this network, a VM in the private VPC network cannot communicate with the outside world. There is a special case, but I will deal with that later.\nTest # Source Destination Connect NAT Dist. Routing 1 demon-private Internet No - - 2 demon-private demon-transit Yes - Yes 3 demon-private demon-public Yes - Yes 4 demon-private core-private No - - 5 demon-private core-transit No - - 6 demon-private core-public No - - 7 External demon-private No - - 8 demon-private blue-private No - - 9 demon-private blue-transit No - - 10 demon-private blue-public No - - alpine02-demon-transit Test # Source Destination Connect NAT Dist. Routing 1 demon-transit Internet No - - 2 demon-transit demon-private Yes - Yes 3 demon-transit demon-public Yes - Yes 4 demon-transit core-private No - - 5 demon-transit core-transit Yes - Yes 6 demon-transit core-public Yes - Yes 7 External demon-transit No - - 8 demon-transit blue-private No - - 9 demon-transit blue-transit No - - 10 demon-transit blue-public No - - alpine03-demon-public Test # Source Destination Connect NAT Dist. Routing 1 demon-public Internet Yes - Yes 2 demon-public demon-private Yes - Yes 3 demon-public demon-transit Yes - Yes 4 demon-public core-private No - - 5 demon-public core-transit Yes - Yes 6 demon-public core-public Yes - Yes 7 External demon-public Yes - Yes 8 demon-public blue-private No - - 9 demon-public blue-transit No - - 10 demon-public blue-public Yes - No That’s a lot of connections. Why is that? Technically speaking, the VM shoud be located in VLAN 1011. But is that really true? Let’s take a closer look.\nThe magic of the distributed transit gateway When we look at a traceflow of the VM alpine03-demon-public, we see that the VM is routing even though I am addressing my physical router.\nalpine03-demon-public:~# traceroute 192.168.11.1 traceroute to 192.168.11.1 (192.168.11.1), 30 hops max, 46 byte packets 1 10.28.11.17 (10.28.11.17) 0.224 ms 0.168 ms 0.048 ms 2 100.64.0.0 (100.64.0.0) 0.064 ms 0.079 ms 0.038 ms 3 192.168.11.1 (192.168.11.1) 0.265 ms 0.168 ms 0.188 ms In NSX, it looks like this:\nNSX Traceflow (click to enlarge)\nMaybe we should take a look at the trace flow from my router.\n[admin@ToR.lab.home] \u003e tool/traceroute 10.28.11.19 ADDRESS LOSS SENT LAST AVG BEST WORST STD-DEV STATUS 10.28.11.19 0% 7 0.6ms 0.5 0.3 0.6 0.1 It appears unusual, as if the VM were directly in the VLAN. As a cross-check from my Mac computer, we also do not see 100.64.0.0 or 10.28.11.17 in the traceroute.\ndanielkrieger@MBP-DKrieger  ~  traceroute 10.28.11.19 traceroute to 10.28.11.19 (10.28.11.19), 64 hops max, 40 byte packets 1 firewall.lab.home (192.168.10.1) 1.076 ms 0.331 ms 0.204 ms 2 192.168.9.2 (192.168.9.2) 0.651 ms 0.357 ms 0.309 ms 3 10.28.11.19 (10.28.11.19) 0.810 ms 1.100 ms 0.482 ms Wait a minute. What is VMware doing?\nFrom an external perspective, my Mikrotik router can address the VM directly, and I can also see the MAC address of the VM on the switch port of the ESX server in the router’s ARP table. From the outside, it actually looks as if the VM is in VLAN 1011 as normal. However, the VM would then be unable to communicate because if we take a closer look at the VM’s IP address, we can see that it is in a subnet of 10.28.11.16/28 and its default gateway is not .1 (Mikrotik router) but .17.\nalpine03-demon-public:~# ip a 2: eth0: mtu 1500 qdisc pfifo_fast state UP qlen 1000 link/ether 00:50:56:bf:5e:0c brd ff:ff:ff:ff:ff:ff inet 10.28.11.19/28 scope global eth0 valid_lft forever preferred_lft forever inet6 fe80::250:56ff:febf:5e0c/64 scope link valid_lft forever preferred_lft forever alpine03-demon-public:~# route -e Kernel IP routing table Destination Gateway Genmask Flags MSS Window irtt Iface default 10.28.11.17 0.0.0.0 UG 0 0 0 eth0 10.28.11.16 * 255.255.255.240 U 0 0 0 eth0 Another indication that the VM cannot be in a VLAN is the fact that I can route to private VPC networks without without an T0. The VM is therefore in an overlay network.\nAs we can see in the Traceflow Tool in NSX, the traffic is sent to the Transit Gateway and then directly to the VLAN. Since our transit gateway is distributed, all of this happens on the ESX server on which the VM is currently running. This clarifies the outgoing traffic, but how does the response get back?\nWell, I mentioned that my Mikrotik switch knows the MAC address of the VM on the switch port of the ESX server. In addition, my Mikrotik does not know the subnets that NSX creates for the VPCs but the router has a /24 route for the complete Public network.\nTo ensure that data traffic arrives at the correct ESX, the distributed Transit Gateway running on the ESX hosting the VM responds to ARP requests for the VM, allowing my Mikrotik router to send the data traffic to the correct ESX server. The distributed Transit Gateway will never respond to ARP requests for VMs hosted on a different ESX. The ESX server receives the traffic and sends it directly to the VM.\nInsert the “Nice Meme” here.\nInfo\rThe NSX reference design guide for NSX 9 also describes this in great detail. However, I will try to show actual trace flows and screenshots here, rather than just pure theory.\rAttention\rWhen connecting to multiple VLANs, administrators can configure optional routes to external networks, with each route specifying the external gateway of the corresponding VLAN as the next hop destination.\nIn scenarios where multiple distributed Transit Gateways share the same VLAN, inter-DTGW communication occurs through hairpin routing via the external gateway.\nThat was quite a lot, but we’re still not quite done, because there’s also a NAT column in my test table.\nExternal IPs aka reflexive NAT Similar to centralized deployment, it is possible to expose a VM from a private VPC network. However, since we do not have an edge, this is only possible via reflexive (stateless) NAT. The procedure is the same: we go to the settings of the VPC demon under Additional Configurations and select External IPs. In the dialog, we can only select VMs that have not yet been assigned an external IP and that have a connection in either a transit or private VPC network.\nVPC-Demon External IPs(click to enlarge)\nAs we can see in the screenshot, an IP address from the public VPC network range has been assigned. The VM alpine01-demon-private can be accessed directly via the IP 10.28.11.2 and can also communicate with the Internet via this address. The complete communication is as follows:\nTest # Source Destination Connect NAT Dist. Routing 1 demon-private Internet Yes Yes Yes 2 demon-private demon-transit Yes No Yes 3 demon-private demon-public Yes No Yes 4 demon-private core-private No - - 5 demon-private core-transit No - - 6 demon-private core-public Yes Yes Yes 7 External demon-private Yes Yes Yes 8 demon-private blue-private No - - 9 demon-private blue-transit No - - 10 demon-private blue-public Yes Yes No Unlike a VPC with Auto SNAT enabled, it is not possible to communicate from a private VPC network with static NAT to a transit network of another VPC.\nInfo\rReflexive NAT is not visible or configurable for the VPC via the NSX GUI. You can only set the external IP to be assigned automatically.\rWith get transport-node external-ip, you can view the external IPs implemented on the ESX host in nsxcli.\nvcf09-m01-esx01.lab.home\u003e get transport-node external-ip Thu Jun 26 2025 UTC 17:08:36.740 External IP Mapping Table ----------------------------------------------------------------------------------------------------------------------------- External IP Internal IP Discovered Internal IP Seen VNI MAC Address Port ID 10.28.11.2 192.168.5.3 0.0.0.0 69634 00:50:56:bf:5d:b1 67108886 The NSX Reference Design Guide contains traffic flow diagrams for almost all of my tests, for anyone who would like to review everything in detail. Conclusion This article shows how VPCs can be operated in NSX 9 in a distributed architecture without any edge clusters. Of particular interest is the functionality of the Distributed Transit Gateway, which transparently mediates between overlay and physical VLAN networks. Despite the absence of edges, many core functions such as routing, public access, and external connections remain fully usable via Reflexive NAT and distributed routing.\nThe setup allows virtual network functions to be deployed independently of the NSX Edges in a tenant. These could, for example, be provided by a tenant customer themselves. VPCs have become significantly more powerful and exciting than they were in NSX 4.X. This increases flexibility, but also, to be fair, increases complexity. When designing, you have to think more about traffic flow and when traffic is distributed and when it is not. The transit gateway is an exciting new feature and is already familiar from the public cloud sector.\nI think in the next VPC article I will deal with the topic of security.\n",
    "wordCount" : "2711",
    "inLanguage": "en",
    "image":"https://sdn-warrior.org/images/head.jpg","datePublished": "2025-06-26T19:00:00+02:00",
    "dateModified": "2025-06-26T19:00:00+02:00",
    "author":{
        "@type": "Person",
        "name": "SDN-Warrior",
        "url": "https://sdn-warrior.org/about/"
        },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://sdn-warrior.org/posts/vcf9-nsx-vpc-part2/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "SDN-Warrior | Daniel Krieger",
      "description": "",
      "logo": {
        "@type": "ImageObject",
        "url": "https://sdn-warrior.org/favicon.ico"
      }
    }
}
</script><title>VCF 9 - NSX VPC Part 2 - distributed Transit Gateway</title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="https://sdn-warrior.org/css/style.min.7706d41cf39b63c8212d7b2ed530370bd8fb982204a76fb53dd6353aa90820bd.css" integrity="sha256-dwbUHPObY8ghLXsu1TA3C9j7mCIEp2+1PdY1OqkIIL0=" crossorigin="anonymous">
	<style>.bg-img {background-image: url('/images/head.jpg');}</style></head>
<body id="page">
	<header id="site-header">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://sdn-warrior.org/">SDN-Warrior | Daniel Krieger</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="https://sdn-warrior.org/posts/">Posts</a><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a><a href="https://sdn-warrior.org/links/">Links</a><a href="https://sdn-warrior.org/about/">About Me</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<button id="img-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image">
      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
      <circle cx="8.5" cy="8.5" r="1.5"></circle>
      <polyline points="21 15 16 10 5 21"></polyline>
   </svg></button><span class="hdr-links hide-in-mobile"><a href="https://de.linkedin.com/in/daniel-krieger-6476591a9" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2">
      <circle cx="18" cy="5" r="3"></circle>
      <circle cx="6" cy="12" r="3"></circle>
      <circle cx="18" cy="19" r="3"></circle>
      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
   </svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf9-nsx-vpc-part2%2f&amp;text=VCF%209%20-%20NSX%20VPC%20Part%202%20-%20distributed%20Transit%20Gateway" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6" />
</svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf9-nsx-vpc-part2%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
</svg></a>
        </li>
        <li>
            <a href="mailto:?subject=VCF%209%20-%20NSX%20VPC%20Part%202%20-%20distributed%20Transit%20Gateway&amp;body=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf9-nsx-vpc-part2%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
   <polyline points="22,6 12,13 2,6"></polyline>
</svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsdn-warrior.org%2fposts%2fvcf9-nsx-vpc-part2%2f&amp;source=https%3a%2f%2fsdn-warrior.org%2f&amp;title=VCF%209%20-%20NSX%20VPC%20Part%202%20-%20distributed%20Transit%20Gateway&amp;summary=VCF%209%20-%20NSX%20VPC%20Part%202%20-%20distributed%20Transit%20Gateway%2c%20by%20SDN-Warrior%0a%0aA%20short%20article%20about%20VPCs%20in%20NSX%209%20and%20VCF%209%20Part%202.%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none"
   stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
   <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
   <rect x="2" y="9" width="4" height="12"></rect>
   <circle cx="4" cy="4" r="2"></circle>
</svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;VCF 9 - NSX VPC Part 2 - distributed Transit Gateway&#34;,&#34;https://sdn-warrior.org/posts/vcf9-nsx-vpc-part2/&#34;,&#34;VCF 9 - NSX VPC Part 2 - distributed Transit Gateway, by SDN-Warrior\n\nA short article about VPCs in NSX 9 and VCF 9 Part 2.\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy">
      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
   </svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
   </svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://sdn-warrior.org/posts/">Posts</a></li>
			<li><a href="https://sdn-warrior.org/lab-bom/">Lab BOM</a></li>
			<li><a href="https://sdn-warrior.org/links/">Links</a></li>
			<li><a href="https://sdn-warrior.org/about/">About Me</a></li>
		</ul>
	</div>


	<div class="bg-img"></div>
	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Jun 26, 2025</span></div>
				<h1>VCF 9 - NSX VPC Part 2 - distributed Transit Gateway</h1>
			</header>
			<div class="post-info"><p>A short article about VPCs in NSX 9 and VCF 9 Part 2.</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
   stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather">
   <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
   <line x1="16" y1="8" x2="2" y2="22"></line>
   <line x1="17.5" y1="15" x2="9" y2="15"></line>
</svg><a href="/about/" target="_blank">SDN-Warrior</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon">
      <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
      <line x1="7" y1="7" x2="7" y2="7"></line>
   </svg><span class="tag"><a href="https://sdn-warrior.org/tags/vcf">vcf</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/nsx">nsx</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/homelab">homelab</a></span><span class="tag"><a href="https://sdn-warrior.org/tags/vpc">vpc</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
      <polyline points="14 2 14 8 20 8"></polyline>
      <line x1="16" y1="13" x2="8" y2="13"></line>
      <line x1="16" y1="17" x2="8" y2="17"></line>
      <polyline points="10 9 9 9 8 9"></polyline>
   </svg>2711 Words
     Words // ReadTime
    
    
    
    12 Minutes, 19 Seconds</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
   </svg>2025-06-26 19:00 &#43;0200</p></div>
			<hr class="post-end">
			<div class="content">
				<h2 id="introduction">Introduction<a href="#introduction" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>This is the second article in a series of articles (number of articles unknown) about VPCs in VCF 9.
If you are not familiar with VPCs and have not yet come across this topic, I recommend reading <a href="https://sdn-warrior.org/posts/vcf9-nsx-vpc/">Part 1</a> first.
I will not go into all the basics again in this article, as these were already explained in the first article.
In this article, I will look at the distributed deployment of VPCs and show how VPCs can also be used without an edge cluster.</p>
<p>Wait, did he really just write VPCs without Edge Clusters?! Sounds good, right?</p>
<h2 id="lets-go---nsx-project">Let&rsquo;s go - NSX project<a href="#lets-go---nsx-project" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>First things first.
Since I am using the same VCF 9 installation as in my first article and we already have VPCs in centralized deployment here, I first create a new NSX project.
Perhaps I should mention NSX Projects again here. VMware writes in the VCF 9 Guide:
<em><strong>A project in NSX is analogous to a tenant. By creating projects, you can isolate security and networking objects across tenants in a single NSX deployment.</strong></em></p>
<p>I think that description fits quite well.
In addition, we can currently only have one transit gateway per project.
Since our default tenant (aka default project) has a transit gateway in centralized deployment, I need a new tenant aka project.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">A small addition: whenever I refer to “tenant” in this article, I actually mean NSX project, but I find the name NSX project a bit cumbersome.</div>
    </aside>
<p>To create a new tenant, click on the Project drop-down menu in the NSX GUI and then click on Manage.</p>

<figure><a href="01.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/01_hu_53d822ddc525f.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/01_hu_37420b69267c8cfe.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/01_hu_53d822ddc525f.webp"alt="NSX 9 VPC Manhatten"  width="1151"  height="1120" />
        </picture></a><figcaption>
            <p>NSX 9 project Manhatten (click to enlarge)</p>
          </figcaption></figure>
<p>The most important setting besides the name (yes, I recently watched Oppenheimer) is the External Connection.
These settings determine whether the transit gateway is distributed or centralized.
The External IP Block defines the public VPC network (I explained the different networks in VPCs in <a href="https://sdn-warrior.org/posts/vcf9-nsx-vpc/">Part 1</a>).
We have the option of connecting the project to a T0 gateway independently of the transit gateway.
However, this is only relevant for non-VPC networks and will not be considered here.
The same applies to the option of assigning an edge cluster to the tenant.
Since I really want to avoid edges entirely in this article, we will also ignore this option.
We also have the option of setting distributed firewall rules directly, which only allows communication within the tenant, but since firewalling will be covered in another article, we will ignore this option and disable it.</p>
<p>
    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">In the NSX project create dialog, you can create a new external connection and external IP blocks using the three-dot menu.</div>
    </aside>
We save our Manhattan project and now we have a fresh new tenant.</p>
<h2 id="external-connection---the-distributed-version">External Connection - the distributed version<a href="#external-connection---the-distributed-version" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>We should take another closer look at the topic of external connections.</p>

<figure><a href="02.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/02_hu_e4bcb1bf559da5b7.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/02_hu_aaf66fae63630a47.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/02_hu_e4bcb1bf559da5b7.webp"alt="Manhatten External Connection"  width="1669"  height="826" />
        </picture></a><figcaption>
            <p>NSX 9 project Manhatten external connection (click to enlarge)</p>
          </figcaption></figure>
<p>Since we have a distributed connection here, we need a VLAN and a gateway in my physical network.
In my lab, it is VLAN 1011 and my Mikrotik Core Router has 10.28.11.1/24. My external IP block also comes from the network area of VLAN 1011, as my physical router has to route to this network.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">NSX 9 currently only supports static routing, and if I had used a different external IP block, I would have had to set up additional routes on my Mikrotik – laziness wins out in this case.</div>
    </aside>
<h2 id="lets-build-a-vpc-or-two-or">Let&rsquo;s build a VPC, or two, or&hellip;<a href="#lets-build-a-vpc-or-two-or" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Readers of <a href="https://sdn-warrior.org/posts/vcf9-nsx-vpc/">Part 1</a> should now be quite familiar with all of this.</p>

<figure><a href="03.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/03_hu_48978bf52479495.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/03_hu_120896229c7b9a23.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/03_hu_48978bf52479495.webp"alt="VCP"  width="1715"  height="1211" />
        </picture></a><figcaption>
            <p>get started with VPC (click to enlarge)</p>
          </figcaption></figure>
<p>First, we set up our private transit gateway IP block in the VPC Connectivity Profile or create one. Remember, this is an unrouted network, but it must not overlap with the other private VPC networks for all tenants.
This network is used to connect VPCs to each other and is an NSX overlay network.
Next, I configure the service profile, which is where I can configure a DHCP service for my VPC, and finally I create the private PVC IP CIDRs.
As in my other article, this will again be 192.168.5.0/24.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">The private VPC IP CIDRs may overlap with other private VPC networks, as they are not routed between VPCs.</div>
    </aside>
<p>That&rsquo;s it, our VPC has been created and we can now create our first VPC subnets. I will create a public, a private, and a transit network, each with 16 IPs and DHCP enabled.
In addition, I will create the VPC Core in the same way. I hope the Demon Core doesn&rsquo;t get too close - nudge nudge wink wink.</p>
<p>The tenants&rsquo; VPC networks are displayed in vCenter, but they are managed by NSX. This means that they cannot be extended or created via vCenter as in our default project.</p>
<h2 id="test-architecture">Test architecture<a href="#test-architecture" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I created six test VMs and assigned one VM to each VPC network. For a quick overview, here is a table showing all VMs.</p>
<table>
  <thead>
      <tr>
          <th>VM Name</th>
          <th>Network Type</th>
          <th>Gateway</th>
          <th>IP Address</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>alpine01-demon-private</td>
          <td>private</td>
          <td>192.168.5.1/28</td>
          <td>192.168.5.3</td>
      </tr>
      <tr>
          <td>alpine02-demon-transit</td>
          <td>transit</td>
          <td>10.28.22.1/28</td>
          <td>10.28.22.3</td>
      </tr>
      <tr>
          <td>alpine03-demon-public</td>
          <td>public</td>
          <td>10.28.11.17/28</td>
          <td>10.28.11.19</td>
      </tr>
      <tr>
          <td>alpine04-core-private</td>
          <td>private</td>
          <td>192.168.5.1/28</td>
          <td>192.168.5.3</td>
      </tr>
      <tr>
          <td>alpine05-core-transit</td>
          <td>transit</td>
          <td>10.28.22.17/28</td>
          <td>10.28.22.19</td>
      </tr>
      <tr>
          <td>alpine06-core-public</td>
          <td>public</td>
          <td>10.28.11.33/28</td>
          <td>10.28.11.35</td>
      </tr>
  </tbody>
</table>
<p>The final VPC structure of the Manhattan tenant looks like this:</p>

<figure><a href="04.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/04_hu_935b24fe0e6af886.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/04_hu_904d3b981763cd18.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/04_hu_935b24fe0e6af886.webp"alt="VCP Manhatten"  width="1560"  height="916" />
        </picture></a><figcaption>
            <p>VPCs tenant Manhatten (click to enlarge)</p>
          </figcaption></figure>
<p>We can also test the interconnectivity between the VPCs from <a href="https://sdn-warrior.org/posts/vcf9-nsx-vpc/">Part 1</a>. The overall network topology looks like this:</p>

<figure><a href="05.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/05_hu_433eec8d2e4efae9.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/05_hu_552462bf996a85fc.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/05_hu_433eec8d2e4efae9.webp"alt="VCP all projects"  width="2922"  height="1002" />
        </picture></a><figcaption>
            <p>VPCs of all tenants (click to enlarge)</p>
          </figcaption></figure>
<p>Here are the test VMs from the first article:</p>
<table>
  <thead>
      <tr>
          <th>VM Name</th>
          <th>Network Type</th>
          <th>Gateway</th>
          <th>IP Adress</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>alpine01-blue-private</td>
          <td>private</td>
          <td>192.168.5.1/28</td>
          <td>192.168.5.3</td>
      </tr>
      <tr>
          <td>alpine02-blue-transit</td>
          <td>transit</td>
          <td>10.28.12.1/28</td>
          <td>10.28.12.3</td>
      </tr>
      <tr>
          <td>alpine03-blue-public</td>
          <td>public</td>
          <td>192.168.72.17/28</td>
          <td>192.168.72.19</td>
      </tr>
      <tr>
          <td>alpine04-red-private</td>
          <td>private</td>
          <td>192.168.5.1/28</td>
          <td>192.168.5.4</td>
      </tr>
      <tr>
          <td>alpine05-red-transit</td>
          <td>transit</td>
          <td>10.28.12.17/28</td>
          <td>10.28.12.19</td>
      </tr>
      <tr>
          <td>alpine06-red-public</td>
          <td>public</td>
          <td>192.168.72.33/28</td>
          <td>192.168.72.35</td>
      </tr>
  </tbody>
</table>
<h2 id="test-scenarios">Test scenarios<a href="#test-scenarios" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I will perform certain tests for each VM from VPC-Demon. First, I will test Internet connectivity, then intra-VPC connectivity, i.e., communication with all VMs in VPC-Demon, and finally inter-VPC connectivity, i.e., communication with all VMs in VPC-Core.
Finally, I will perform a connectivity test from outside the NSX environment and a connection test to the VMs from VPC-BLUE.
I will do all of this with simple ICMP tests. To do this, all firewalls on NSX and the VMs have been disabled.
That&rsquo;s a lot of tests, so let&rsquo;s get started.</p>
<h2 id="alpine01-demon-private">alpine01-demon-private<a href="#alpine01-demon-private" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>I will describe the tests using examples. For the other VMSs, I will present the results in a table.</p>
<h3 id="internet-connectivity">Internet connectivity<a href="#internet-connectivity" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>In my first test, I want to see where alpine01-demon-private can communicate.
The VM was assigned the IP address 192.168.5.3 by DHCP.
Since our transit gateway was created in distributed mode, we cannot use auto SNAT and generally have no way of using stateful services.
This means that the VM cannot communicate with the internet because the VPC private network is not routed and no SNAT is performed in the public network.</p>
<h3 id="intra-vpc-connectivity">Intra VPC connectivity<a href="#intra-vpc-connectivity" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Next, I test the connectivity to the alpine02-demon-transit vm. This test is also successful, as the transit VM can also be accessed via the VPC gateway.
I also reach alpine03-demon-public vm. This happens fully distributed. Cool.</p>
<h3 id="inter-vpc-connectivity">Inter VPC connectivity<a href="#inter-vpc-connectivity" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>This is where it gets exciting. Basically, I can only access VMs from the same VPC here.
If I had <em><strong>stateful SNAT</strong></em>, I could also access the public VMs of other VPCs belonging to other tenants or VMs of other VPCs in the transit network of my own tenant (provided the firewall allows this).
Since we do not have NAT, a VM from a private VPC network cannot establish an intra-VPC connection.</p>
<h3 id="external-connectivity">External connectivity<a href="#external-connectivity" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>The VM cannot be accessed externally. My core router also does not have a route for the 192.168.5.0/28 subnet.
Even if my router has a route for this network, a VM in the private VPC network cannot communicate with the outside world.
There is a special case, but I will deal with that later.</p>
<table>
  <thead>
      <tr>
          <th>Test #</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Connect</th>
          <th>NAT</th>
          <th>Dist. Routing</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>demon-private</td>
          <td>Internet</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>2</td>
          <td>demon-private</td>
          <td>demon-transit</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>3</td>
          <td>demon-private</td>
          <td>demon-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>4</td>
          <td>demon-private</td>
          <td>core-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>5</td>
          <td>demon-private</td>
          <td>core-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>6</td>
          <td>demon-private</td>
          <td>core-public</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>7</td>
          <td>External</td>
          <td>demon-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>8</td>
          <td>demon-private</td>
          <td>blue-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>9</td>
          <td>demon-private</td>
          <td>blue-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>10</td>
          <td>demon-private</td>
          <td>blue-public</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
  </tbody>
</table>
<h2 id="alpine02-demon-transit">alpine02-demon-transit<a href="#alpine02-demon-transit" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<table>
  <thead>
      <tr>
          <th>Test #</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Connect</th>
          <th>NAT</th>
          <th>Dist. Routing</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>demon-transit</td>
          <td>Internet</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>2</td>
          <td>demon-transit</td>
          <td>demon-private</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>3</td>
          <td>demon-transit</td>
          <td>demon-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>4</td>
          <td>demon-transit</td>
          <td>core-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>5</td>
          <td>demon-transit</td>
          <td>core-transit</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>6</td>
          <td>demon-transit</td>
          <td>core-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>7</td>
          <td>External</td>
          <td>demon-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>8</td>
          <td>demon-transit</td>
          <td>blue-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>9</td>
          <td>demon-transit</td>
          <td>blue-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>10</td>
          <td>demon-transit</td>
          <td>blue-public</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
  </tbody>
</table>
<h2 id="alpine03-demon-public">alpine03-demon-public<a href="#alpine03-demon-public" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<table>
  <thead>
      <tr>
          <th>Test #</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Connect</th>
          <th>NAT</th>
          <th>Dist. Routing</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>demon-public</td>
          <td>Internet</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>2</td>
          <td>demon-public</td>
          <td>demon-private</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>3</td>
          <td>demon-public</td>
          <td>demon-transit</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>4</td>
          <td>demon-public</td>
          <td>core-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>5</td>
          <td>demon-public</td>
          <td>core-transit</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>6</td>
          <td>demon-public</td>
          <td>core-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>7</td>
          <td>External</td>
          <td>demon-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>8</td>
          <td>demon-public</td>
          <td>blue-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>9</td>
          <td>demon-public</td>
          <td>blue-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>10</td>
          <td>demon-public</td>
          <td>blue-public</td>
          <td>Yes</td>
          <td>-</td>
          <td>No</td>
      </tr>
  </tbody>
</table>
<p>That&rsquo;s a lot of connections. Why is that? Technically speaking, the VM shoud be located in VLAN 1011. But is that really true? Let&rsquo;s take a closer look.</p>
<h2 id="the-magic-of-the-distributed-transit-gateway">The magic of the distributed transit gateway<a href="#the-magic-of-the-distributed-transit-gateway" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>When we look at a traceflow of the VM alpine03-demon-public, we see that the VM is routing even though I am addressing my physical router.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">alpine03-demon-public:~# traceroute 192.168.11.1
</span></span><span class="line"><span class="cl">traceroute to 192.168.11.1 (192.168.11.1), 30 hops max, 46 byte packets
</span></span><span class="line"><span class="cl"> 1  10.28.11.17 (10.28.11.17)  0.224 ms  0.168 ms  0.048 ms
</span></span><span class="line"><span class="cl"> 2  100.64.0.0 (100.64.0.0)  0.064 ms  0.079 ms  0.038 ms
</span></span><span class="line"><span class="cl"> 3  192.168.11.1 (192.168.11.1)  0.265 ms  0.168 ms  0.188 ms
</span></span></code></pre></div><p>In NSX, it looks like this:</p>

<figure><a href="06.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/06_hu_c49da3aea9aaf425.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/06_hu_e078d513e4c3977a.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/06_hu_c49da3aea9aaf425.webp"alt="VCP traceflow"  width="1450"  height="925" />
        </picture></a><figcaption>
            <p>NSX Traceflow (click to enlarge)</p>
          </figcaption></figure>
<p>Maybe we should take a look at the trace flow from my router.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">[admin@ToR.lab.home] &gt; tool/traceroute 10.28.11.19
</span></span><span class="line"><span class="cl">ADDRESS                          LOSS SENT    LAST     AVG    BEST   WORST STD-DEV STATUS                                                       
</span></span><span class="line"><span class="cl">10.28.11.19                        0%    7   0.6ms     0.5     0.3     0.6     0.1                                                              
</span></span></code></pre></div><p>It appears unusual, as if the VM were directly in the VLAN. As a cross-check from my Mac computer, we also do not see 100.64.0.0 or 10.28.11.17 in the traceroute.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl"> danielkrieger@MBP-DKrieger  ~  traceroute 10.28.11.19
</span></span><span class="line"><span class="cl">traceroute to 10.28.11.19 (10.28.11.19), 64 hops max, 40 byte packets
</span></span><span class="line"><span class="cl"> 1  firewall.lab.home (192.168.10.1)  1.076 ms  0.331 ms  0.204 ms
</span></span><span class="line"><span class="cl"> 2  192.168.9.2 (192.168.9.2)  0.651 ms  0.357 ms  0.309 ms
</span></span><span class="line"><span class="cl"> 3  10.28.11.19 (10.28.11.19)  0.810 ms  1.100 ms  0.482 ms
</span></span></code></pre></div><p>Wait a minute. What is VMware doing?</p>
<p>From an external perspective, my Mikrotik router can address the VM directly, and I can also see the MAC address of the VM on the switch port of the ESX server in the router&rsquo;s ARP table.
From the outside, it actually looks as if the VM is in VLAN 1011 as normal. However, the VM would then be unable to communicate because if we take a closer look at the VM&rsquo;s IP address, we can see that it is in a subnet of 10.28.11.16/28 and its default gateway is not .1 (Mikrotik router) but .17.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">alpine03-demon-public:~# ip a
</span></span><span class="line"><span class="cl">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
</span></span><span class="line"><span class="cl">    link/ether 00:50:56:bf:5e:0c brd ff:ff:ff:ff:ff:ff
</span></span><span class="line"><span class="cl">    inet 10.28.11.19/28 scope global eth0
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">    inet6 fe80::250:56ff:febf:5e0c/64 scope link 
</span></span><span class="line"><span class="cl">       valid_lft forever preferred_lft forever
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">alpine03-demon-public:~# route -e
</span></span><span class="line"><span class="cl">Kernel IP routing table
</span></span><span class="line"><span class="cl">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
</span></span><span class="line"><span class="cl">default         10.28.11.17     0.0.0.0         UG        0 0          0 eth0
</span></span><span class="line"><span class="cl">10.28.11.16     *               255.255.255.240 U         0 0          0 eth0
</span></span></code></pre></div><p>Another indication that the VM cannot be in a VLAN is the fact that I can route to private VPC networks without without an T0. The VM is therefore in an overlay network.</p>
<p>As we can see in the Traceflow Tool in NSX, the traffic is sent to the Transit Gateway and then directly to the VLAN. Since our transit gateway is distributed, all of this happens on the ESX server on which the VM is currently running.
This clarifies the outgoing traffic, but how does the response get back?</p>
<p>Well, I mentioned that my Mikrotik switch knows the MAC address of the VM on the switch port of the ESX server.
In addition, my Mikrotik does not know the subnets that NSX creates for the VPCs but the router has a /24 route for the complete Public network.</p>
<p>To ensure that data traffic arrives at the correct ESX, the distributed Transit Gateway running on the ESX hosting the VM responds to ARP requests for the VM, allowing my Mikrotik router to send the data traffic to the correct ESX server. The distributed Transit Gateway will never respond to ARP requests for VMs hosted on a different ESX.
The ESX server receives the traffic and sends it directly to the VM.</p>
<p>Insert the “Nice Meme” here.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">The NSX reference design guide for NSX 9 also describes this in great detail. However, I will try to show actual trace flows and screenshots here, rather than just pure theory.</div>
    </aside>

    <aside class="admonition attention">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" class="feather feather-link" width="24" height="24" viewBox="0 0 24 24"
      fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
   </svg></div><b>Attention</b>
        </div>
        <div class="admonition-content"><p>When connecting to multiple VLANs, administrators can configure optional routes to external networks, with each route specifying the external gateway of the corresponding VLAN as the next hop destination.</p>
<p>In scenarios where multiple distributed Transit Gateways share the same VLAN, inter-DTGW communication occurs through hairpin routing via the external
gateway.</p>
</div>
    </aside>
<p>That was quite a lot, but we&rsquo;re still not quite done, because there&rsquo;s also a NAT column in my test table.</p>
<h2 id="external-ips-aka-reflexive-nat">External IPs aka reflexive NAT<a href="#external-ips-aka-reflexive-nat" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>Similar to centralized deployment, it is possible to expose a VM from a private VPC network. However, since we do not have an edge, this is only possible via reflexive (stateless) NAT.
The procedure is the same: we go to the settings of the VPC demon under Additional Configurations and select External IPs.
In the dialog, we can only select VMs that have not yet been assigned an external IP and that have a connection in either a transit or private VPC network.</p>

<figure><a href="07.png"><picture>
          <source srcset="/vcf9-nsx-vpc-2/07_hu_4334ecadd18cf838.webp" type="image/webp">
          <source srcset="/vcf9-nsx-vpc-2/07_hu_b33e3abdaf27debb.jpg" type="image/jpeg">
          <img src="/vcf9-nsx-vpc-2/07_hu_4334ecadd18cf838.webp"alt="VCP external IPs"  width="1158"  height="724" />
        </picture></a><figcaption>
            <p>VPC-Demon External IPs(click to enlarge)</p>
          </figcaption></figure>
<p>As we can see in the screenshot, an IP address from the public VPC network range has been assigned.
The VM alpine01-demon-private can be accessed directly via the IP 10.28.11.2 and can also communicate with the Internet via this address.
The complete communication is as follows:</p>
<table>
  <thead>
      <tr>
          <th>Test #</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Connect</th>
          <th>NAT</th>
          <th>Dist. Routing</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>demon-private</td>
          <td>Internet</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>2</td>
          <td>demon-private</td>
          <td>demon-transit</td>
          <td>Yes</td>
          <td>No</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>3</td>
          <td>demon-private</td>
          <td>demon-public</td>
          <td>Yes</td>
          <td>No</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>4</td>
          <td>demon-private</td>
          <td>core-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>5</td>
          <td>demon-private</td>
          <td>core-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>6</td>
          <td>demon-private</td>
          <td>core-public</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>7</td>
          <td>External</td>
          <td>demon-private</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>8</td>
          <td>demon-private</td>
          <td>blue-private</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>9</td>
          <td>demon-private</td>
          <td>blue-transit</td>
          <td>No</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>10</td>
          <td>demon-private</td>
          <td>blue-public</td>
          <td>Yes</td>
          <td>Yes</td>
          <td>No</td>
      </tr>
  </tbody>
</table>
<p>Unlike a VPC with Auto SNAT enabled, it is not possible to communicate from a private VPC network with static NAT to a transit network of another VPC.</p>

    <aside class="admonition info">
        <div class="admonition-title">
            <div class="icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-info">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="16" x2="12" y2="12"></line>
      <line x1="12" y1="8" x2="12.01" y2="8"></line>
   </svg></div><b>Info</b>
        </div>
        <div class="admonition-content">Reflexive NAT is not visible or configurable for the VPC via the NSX GUI. You can only set the external IP to be assigned automatically.</div>
    </aside>
<p>With <em><strong>get transport-node external-ip</strong></em>, you can view the external IPs implemented on the ESX host in nsxcli.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-plaintext" data-lang="plaintext"><span class="line"><span class="cl">vcf09-m01-esx01.lab.home&gt; get transport-node external-ip 
</span></span><span class="line"><span class="cl">Thu Jun 26 2025 UTC 17:08:36.740
</span></span><span class="line"><span class="cl">                                                  External IP Mapping Table                                                  
</span></span><span class="line"><span class="cl">-----------------------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">       External IP         Internal IP Discovered       Internal IP Seen            VNI          MAC Address       Port ID   
</span></span><span class="line"><span class="cl">       10.28.11.2                192.168.5.3                 0.0.0.0               69634      00:50:56:bf:5d:b1    67108886
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The NSX Reference Design Guide contains traffic flow diagrams for almost all of my tests, for anyone who would like to review everything in detail.
</span></span></code></pre></div><h2 id="conclusion">Conclusion<a href="#conclusion" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>This article shows how VPCs can be operated in NSX 9 in a distributed architecture without any edge clusters. Of particular interest is the functionality of the Distributed Transit Gateway, which transparently mediates between overlay and physical VLAN networks. Despite the absence of edges, many core functions such as routing, public access, and external connections remain fully usable via Reflexive NAT and distributed routing.</p>
<p>The setup allows virtual network functions to be deployed independently of the NSX Edges in a tenant. These could, for example, be provided by a tenant customer themselves. VPCs have become significantly more powerful and exciting than they were in NSX 4.X. This increases flexibility, but also, to be fair, increases complexity. When designing, you have to think more about traffic flow and when traffic is distributed and when it is not. The transit gateway is an exciting new feature and is already familiar from the public cloud sector.</p>
<p>I think in the next VPC article I will deal with the topic of security.</p>

			</div>
			

<div class="related-posts thin">
	<h2>See Also</h2>
	<ul>
	
	<li><a href="/posts/vcf9-nsx-vpc/">VCF 9 - NSX VPC Part 1 - centralized Transit Gateway</a></li>
	
	<li><a href="/posts/nsx-dfw-troubleshooting/">NSX - IDFW &amp; DFW Troubleshooting</a></li>
	
	<li><a href="/posts/homelab-v6/">Homelab V6 - It’s not just Taylor Swift who has different eras, my home lab does too</a></li>
	
	<li><a href="/posts/ms-a2/">Tales from the Lab - Minisforum MS-A2</a></li>
	
	<li><a href="/posts/vcf-single-nsx/">VCF Quick Tip - WLD with single NSX Manager</a></li>
	
	</ul>
</div>

		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://sdn-warrior.org/posts/vcf-operations-migration/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left">
      <line x1="19" y1="12" x2="5" y2="12"></line>
      <polyline points="12 19 5 12 12 5"></polyline>
   </svg>&nbsp;Newer</span><br><span>VCF 9 - Migration to central VCF Operations instance</span>
			</a>
			<a class="prev-post" href="https://sdn-warrior.org/posts/nsx-dfw-troubleshooting/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right">
      <line x1="5" y1="12" x2="19" y2="12"></line>
      <polyline points="12 5 19 12 12 19"></polyline>
   </svg></span><br><span>NSX - IDFW &amp; DFW Troubleshooting</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2025 <a href="https://sdn-warrior.org/">SDN-Warrior</a>
		&#183; COPYRIGHT Daniel Krieger</p>

<script defer src="/klaro/klaro-config.js"></script>

<script defer src="/klaro/klaro.js"></script>
</footer>
<script async src="https://sdn-warrior.org/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js" integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin="anonymous"></script><script async src="https://sdn-warrior.org/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js" integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin="anonymous"></script>
</body>

</html>
